"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunkworkspace_client"] = self["webpackChunkworkspace_client"] || []).push([["public_assets_js_modules_chat_ChatManager_js"],{

/***/ "./public/assets/js/modules/chat/ChatManager.js":
/*!******************************************************!*\
  !*** ./public/assets/js/modules/chat/ChatManager.js ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _ChatSecurityManager_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./ChatSecurityManager.js */ \"./public/assets/js/modules/chat/ChatSecurityManager.js\");\n/* harmony import */ var _ChatWebSocket_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./ChatWebSocket.js */ \"./public/assets/js/modules/chat/ChatWebSocket.js\");\n/**\n * ChatManager - Gestion des messages du chat\n * \n * Responsabilit√©s:\n * - G√©rer le pseudo de l'utilisateur (localStorage)\n * - Communiquer via WebSocket en temps r√©el\n * - Valider les messages (s√©curit√©)\n * - Int√©grer avec ChatSecurityManager\n */\n\n\n\n\nclass ChatManager {\n    constructor(options = {}) {\n        console.log('üîß ChatManager: Construction en cours...');\n        // IDs des √©l√©ments\n        this.pseudoWrapperId = options.pseudoWrapperId || 'chat-widget-pseudo-area';\n        this.pseudoDisplayId = options.pseudoDisplayId || 'chat-widget-pseudo-display';\n        this.pseudoInputId = options.pseudoInputId || 'chat-widget-pseudo-input';\n        this.pseudoConfirmId = options.pseudoConfirmId || 'chat-widget-pseudo-confirm';\n        this.pseudoErrorId = options.pseudoErrorId || 'chat-widget-pseudo-error';\n        this.messagesContainerId = options.messagesContainerId || 'chat-widget-messages';\n        this.inputId = options.inputId || 'chat-widget-input';\n        this.sendButtonId = options.sendButtonId || 'chat-widget-send';\n        this.clearChatBtnId = options.clearChatBtnId || 'chat-widget-clear';\n        \n        // Server URL for remote communication\n        this.serverUrl = options.serverUrl || 'http://localhost:8060';\n        \n        // WebSocket\n        this.webSocket = new _ChatWebSocket_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"]({ serverUrl: this.serverUrl });\n        \n        // √âtat\n        this.pseudo = this.loadPseudo();\n        this.messages = [];\n        this.userCount = 0;\n        this.connectedUsers = [];\n        this.securityConfig = options.securityConfig || {};\n        \n        // Initialiser ChatSecurityManager\n        this.securityManager = new _ChatSecurityManager_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](this.securityConfig);\n        \n        console.log('üîß ChatManager: Construction finie, init()...');\n        this.init();\n    }\n\n    /**\n     * Initialiser le ChatManager\n     */\n    async init() {\n        console.log('üöÄ ChatManager: init() appel√©');\n        \n        // √âcouter les changements d'authentification\n        window.addEventListener('auth-change', (e) => {\n            const user = e.detail?.user;\n            console.log('üîÑ ChatManager: Auth changed:', user);\n            this.pseudo = user ? user.username : null;\n            this.displayPseudo();\n            \n            if (this.pseudo && this.webSocket.isConnected()) {\n                this.webSocket.setPseudo(this.pseudo);\n            }\n        });\n        \n        // Afficher le pseudo\n        this.displayPseudo();\n        \n        // Afficher les messages\n        console.log('üìä Avant renderMessages:', { container: !!document.getElementById(this.messagesContainerId), messages: this.messages.length });\n        this.renderMessages();\n        \n        // Attacher les √©couteurs d'√©v√©nements\n        this.attachEventListeners();\n        \n        // Attendre que le WebSocket soit connect√©, puis envoyer le pseudo s'il existe\n        const connectAndRestoreSession = () => {\n            if (this.webSocket.isConnected()) {\n                if (this.pseudo) {\n                    console.log('‚ú® Reconnexion automatique avec pseudo:', this.pseudo);\n                    this.webSocket.setPseudo(this.pseudo).catch(err => {\n                        console.error('‚ùå Erreur reconnexion:', err);\n                    });\n                }\n            } else {\n                // Attendre un peu et r√©essayer\n                setTimeout(connectAndRestoreSession, 500);\n            }\n        };\n        \n        // V√©rifier la connexion\n        connectAndRestoreSession();\n        \n        // √âcouter les messages WebSocket\n        this.webSocket.onMessage((data) => {\n            console.log('üì® Message WebSocket re√ßu:', data.type, data);\n            if (data.type === 'history') {\n                console.log('üìú Historique re√ßu:', data.messages?.length || 0, 'messages');\n                this.messages = data.messages.map(msg => ({\n                    id: msg.id,\n                    pseudo: msg.pseudo,\n                    text: msg.message,\n                    timestamp: this.formatTime(msg.created_at),\n                    own: msg.pseudo === this.pseudo,\n                    created_at: msg.created_at\n                }));\n                this.renderMessages();\n                this.scrollToBottom();\n            } else if (data.type === 'newMessage') {\n                const msg = data.message;\n                console.log('üí¨ Nouveau message:', msg);\n                this.messages.push({\n                    id: msg.id,\n                    pseudo: msg.pseudo,\n                    text: msg.message,\n                    timestamp: this.formatTime(msg.created_at),\n                    own: msg.pseudo === this.pseudo,\n                    created_at: msg.created_at\n                });\n                console.log('üìù Messages apr√®s ajout:', this.messages.length);\n                this.renderMessages();\n                this.scrollToBottom();\n            } else if (data.type === 'userCount') {\n                console.log('üë• Mise √† jour utilisateurs:', data.count, data.users);\n                this.userCount = data.count;\n                this.connectedUsers = data.users;\n                // Mettre √† jour l'affichage du compteur d'utilisateurs\n                this.displayPseudo();\n            } else if (data.type === 'chatCleared') {\n                console.log('üóëÔ∏è Chat supprim√© par:', data.clearedBy);\n                this.messages = [];\n                this.renderMessages();\n                // Afficher un message de notification\n                const notifElement = document.getElementById(this.messagesContainerId);\n                if (notifElement) {\n                    const notif = document.createElement('div');\n                    notif.className = 'chat-clear-notification';\n                    notif.textContent = `üóëÔ∏è Chat supprim√© par ${data.clearedBy}`;\n                    notif.style.cssText = 'text-align: center; padding: 10px; background: #ffe6e6; color: #cc0000; border-radius: 4px; margin: 10px; font-weight: bold;';\n                    notifElement.appendChild(notif);\n                    setTimeout(() => notif.remove(), 3000);\n                }\n            }\n        });\n        \n        this.webSocket.onError((err) => {\n            console.error('‚ùå Erreur chat:', err);\n        });\n    }\n\n    /**\n     * Attacher les √©couteurs d'√©v√©nements\n     */\n    attachEventListeners() {\n        // Bouton d'envoi de message\n        const sendBtn = document.getElementById(this.sendButtonId);\n        if (sendBtn) {\n            sendBtn.addEventListener('click', () => this.sendMessage());\n        }\n        \n        // Bouton de nettoyage du chat\n        const clearBtn = document.getElementById(this.clearChatBtnId);\n        if (clearBtn) {\n            clearBtn.addEventListener('click', () => this.showClearModal());\n        }\n        \n        // Bouton de confirmation du clear\n        const clearConfirmBtn = document.getElementById('chat-widget-clear-confirm');\n        if (clearConfirmBtn) {\n            clearConfirmBtn.addEventListener('click', () => this.confirmClearChat());\n        }\n        \n        // Bouton d'annulation du clear\n        const clearCancelBtn = document.getElementById('chat-widget-clear-cancel');\n        if (clearCancelBtn) {\n            clearCancelBtn.addEventListener('click', () => this.hideClearModal());\n        }\n    }\n\n    /**\n     * Charger le pseudo depuis la session utilisateur\n     */\n    loadPseudo() {\n        const username = localStorage.getItem('workspace_username');\n        return username || null;\n    }\n\n    /**\n     * Sauvegarder le pseudo (non utilis√©, lecture seule depuis session)\n     */\n    savePseudo(pseudo) {\n        this.pseudo = pseudo;\n    }\n\n    /**\n     * Confirmer le pseudo (non utilis√©, username vient de la session)\n     */\n    confirmPseudo() {\n        const username = localStorage.getItem('workspace_username');\n        if (!username) {\n            console.warn('‚ö†Ô∏è Aucun utilisateur connect√©');\n            return;\n        }\n        \n        this.savePseudo(username);\n        \n        if (this.webSocket.isConnected()) {\n            this.webSocket.setPseudo(username).catch(err => {\n                console.error('‚ùå Erreur lors de l\\'envoi du pseudo:', err);\n            });\n        }\n        \n        this.messages.forEach(msg => {\n            msg.own = msg.pseudo === this.pseudo;\n        });\n        \n        this.displayPseudo();\n        this.renderMessages();\n    }\n\n    /**\n     * Afficher le pseudo avec compteur d'utilisateurs\n     */\n    displayPseudo() {\n        const pseudoDisplay = document.getElementById(this.pseudoDisplayId);\n        \n        if (!pseudoDisplay) return;\n        \n        if (this.pseudo) {\n            const displayCount = this.userCount > 0 ? this.userCount : 0;\n            \n            pseudoDisplay.innerHTML = `\n                <div class=\"chat-pseudo-confirmed\">\n                    <div class=\"chat-pseudo-info\">\n                        <i class=\"fas fa-user\"></i>\n                        <span>${this.escapeHtml(this.pseudo)}</span>\n                    </div>\n                    <div class=\"chat-user-count\">\n                        <i class=\"fas fa-users\"></i>\n                        <span>${displayCount}</span>\n                    </div>\n                </div>\n            `;\n        } else {\n            pseudoDisplay.innerHTML = `\n                <div class=\"chat-pseudo-required\">\n                    <i class=\"fas fa-exclamation-circle\"></i>\n                    <span>Connectez-vous pour utiliser le chat</span>\n                </div>\n            `;\n        }\n    }\n\n    /**\n     * Envoyer un message via WebSocket\n     */\n    async sendMessage() {\n        const input = document.getElementById(this.inputId);\n        if (!input) return;\n        \n        const text = input.value.trim();\n        \n        if (!text) return;\n        if (!this.pseudo) {\n            alert('Vous devez √™tre connect√© pour envoyer des messages');\n            return;\n        }\n        \n        if (text.length > 5000) {\n            console.warn('‚ö†Ô∏è Message trop long');\n            return;\n        }\n        \n        try {\n            if (!this.webSocket.isConnected()) {\n                console.error('‚ùå WebSocket non connect√©');\n                return;\n            }\n            \n            await this.webSocket.sendMessage(this.pseudo, text);\n            input.value = '';\n        } catch (error) {\n            console.error('‚ùå Erreur envoi message:', error);\n        }\n    }\n\n    /**\n     * D√©marrer le polling des nouveaux messages\n     */\n    /**\n     * Afficher les messages\n     */\n    renderMessages() {\n        const container = document.getElementById(this.messagesContainerId);\n        console.log('üé® renderMessages appel√©', { container: !!container, messagesCount: this.messages.length, containerId: this.messagesContainerId });\n        if (!container) {\n            console.error('‚ùå Container pas trouv√©:', this.messagesContainerId);\n            return;\n        }\n        \n        if (this.messages.length === 0) {\n            container.innerHTML = '<div class=\"chat-widget-empty\">Aucun message pour le moment</div>';\n            container.className = 'chat-widget-empty';\n            return;\n        }\n        \n        // Retirer la classe empty si elle existe\n        container.classList.remove('chat-widget-empty');\n        \n        container.innerHTML = this.messages.map(msg => {\n            const className = msg.own ? 'chat-message own' : 'chat-message other';\n            const sanitized = this.sanitizeMessage(msg.text);\n            return `\n                <div class=\"${className}\">\n                    <div class=\"chat-message-pseudo\">${this.sanitizeMessage(msg.pseudo)}</div>\n                    <div class=\"chat-message-content\">\n                        <div class=\"chat-message-text\">${sanitized}</div>\n                    </div>\n                    <div class=\"chat-message-time\">${msg.timestamp}</div>\n                </div>\n            `;\n        }).join('');\n        \n        console.log('‚úÖ Messages rendus:', this.messages.length);\n        // Scroll vers le bas\n        this.scrollToBottom();\n    }\n\n    /**\n     * Afficher la modal de confirmation du clear\n     */\n    showClearModal() {\n        const clearModal = document.getElementById('chat-widget-clear-modal');\n        if (clearModal) {\n            clearModal.classList.add('show');\n        }\n    }\n\n    /**\n     * Masquer la modal de confirmation du clear\n     */\n    hideClearModal() {\n        const clearModal = document.getElementById('chat-widget-clear-modal');\n        if (clearModal) {\n            clearModal.classList.remove('show');\n        }\n    }\n\n    /**\n     * Confirmer et ex√©cuter le clear du chat\n     */\n    async confirmClearChat() {\n        try {\n            const pseudo = this.chatWebSocket?.userPseudo || localStorage.getItem('userPseudo') || 'Unknown';\n            \n            // Envoyer le message WebSocket pour supprimer le chat\n            this.chatWebSocket?.ws?.send(JSON.stringify({\n                type: 'clearChat',\n                pseudo: pseudo\n            }));\n            \n            logger.info(`‚úÖ Demande de suppression du chat envoy√©e`);\n            this.hideClearModal();\n        } catch (error) {\n            console.error('‚ùå Erreur suppression chat:', error);\n            logger.error(`‚ùå Erreur lors de la suppression: ${error.message}`);\n        }\n    }\n\n    /**\n     * Scroll vers le bas du chat\n     */\n    scrollToBottom() {\n        const container = document.getElementById(this.messagesContainerId);\n        if (container) {\n            setTimeout(() => {\n                container.scrollTop = container.scrollHeight;\n            }, 0);\n        }\n    }\n\n    /**\n     * Nettoyer les messages XSS\n     */\n    sanitizeMessage(text) {\n        const div = document.createElement('div');\n        div.textContent = text;\n        return div.innerHTML;\n    }\n\n    /**\n     * Formater l'heure\n     */\n    formatTime(isoString) {\n        try {\n            const date = new Date(isoString);\n            return date.toLocaleTimeString('fr-FR', { \n                hour: '2-digit', \n                minute: '2-digit' \n            });\n        } catch (e) {\n            return new Date().toLocaleTimeString('fr-FR', { \n                hour: '2-digit', \n                minute: '2-digit' \n            });\n        }\n    }\n\n    /**\n     * Destructor - nettoyer quand le widget est ferm√©\n     */\n    destroy() {\n        // WebSocket se ferme automatiquement\n        if (this.webSocket) {\n            this.webSocket.disconnect?.();\n        }\n    }\n\n    escapeHtml(text) {\n        const div = document.createElement('div');\n        div.textContent = text;\n        return div.innerHTML;\n    }\n}\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ChatManager);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wdWJsaWMvYXNzZXRzL2pzL21vZHVsZXMvY2hhdC9DaGF0TWFuYWdlci5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRTJEO0FBQ1o7O0FBRS9DO0FBQ0EsNEJBQTRCO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLHlEQUFhLEdBQUcsMkJBQTJCO0FBQ3hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQywrREFBbUI7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtEQUFrRCxnR0FBZ0c7QUFDbEo7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlFQUFpRSxlQUFlO0FBQ2hGLCtEQUErRCxlQUFlLHFCQUFxQixnQkFBZ0Isb0JBQW9CLGNBQWMsa0JBQWtCO0FBQ3ZLO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyw2QkFBNkI7QUFDN0Q7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLGFBQWE7QUFDN0M7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrREFBa0Qsb0dBQW9HO0FBQ3RKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QixVQUFVO0FBQ3hDLHVEQUF1RCxpQ0FBaUM7QUFDeEY7QUFDQSx5REFBeUQsVUFBVTtBQUNuRTtBQUNBLHFEQUFxRCxjQUFjO0FBQ25FO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0EsNkRBQTZELGNBQWM7QUFDM0U7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsaUVBQWUsV0FBVyxFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd29ya3NwYWNlLWNsaWVudC8uL3B1YmxpYy9hc3NldHMvanMvbW9kdWxlcy9jaGF0L0NoYXRNYW5hZ2VyLmpzP2NjYjkiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDaGF0TWFuYWdlciAtIEdlc3Rpb24gZGVzIG1lc3NhZ2VzIGR1IGNoYXRcbiAqIFxuICogUmVzcG9uc2FiaWxpdMOpczpcbiAqIC0gR8OpcmVyIGxlIHBzZXVkbyBkZSBsJ3V0aWxpc2F0ZXVyIChsb2NhbFN0b3JhZ2UpXG4gKiAtIENvbW11bmlxdWVyIHZpYSBXZWJTb2NrZXQgZW4gdGVtcHMgcsOpZWxcbiAqIC0gVmFsaWRlciBsZXMgbWVzc2FnZXMgKHPDqWN1cml0w6kpXG4gKiAtIEludMOpZ3JlciBhdmVjIENoYXRTZWN1cml0eU1hbmFnZXJcbiAqL1xuXG5pbXBvcnQgQ2hhdFNlY3VyaXR5TWFuYWdlciBmcm9tICcuL0NoYXRTZWN1cml0eU1hbmFnZXIuanMnO1xuaW1wb3J0IENoYXRXZWJTb2NrZXQgZnJvbSAnLi9DaGF0V2ViU29ja2V0LmpzJztcblxuY2xhc3MgQ2hhdE1hbmFnZXIge1xuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMgPSB7fSkge1xuICAgICAgICBjb25zb2xlLmxvZygn8J+UpyBDaGF0TWFuYWdlcjogQ29uc3RydWN0aW9uIGVuIGNvdXJzLi4uJyk7XG4gICAgICAgIC8vIElEcyBkZXMgw6lsw6ltZW50c1xuICAgICAgICB0aGlzLnBzZXVkb1dyYXBwZXJJZCA9IG9wdGlvbnMucHNldWRvV3JhcHBlcklkIHx8ICdjaGF0LXdpZGdldC1wc2V1ZG8tYXJlYSc7XG4gICAgICAgIHRoaXMucHNldWRvRGlzcGxheUlkID0gb3B0aW9ucy5wc2V1ZG9EaXNwbGF5SWQgfHwgJ2NoYXQtd2lkZ2V0LXBzZXVkby1kaXNwbGF5JztcbiAgICAgICAgdGhpcy5wc2V1ZG9JbnB1dElkID0gb3B0aW9ucy5wc2V1ZG9JbnB1dElkIHx8ICdjaGF0LXdpZGdldC1wc2V1ZG8taW5wdXQnO1xuICAgICAgICB0aGlzLnBzZXVkb0NvbmZpcm1JZCA9IG9wdGlvbnMucHNldWRvQ29uZmlybUlkIHx8ICdjaGF0LXdpZGdldC1wc2V1ZG8tY29uZmlybSc7XG4gICAgICAgIHRoaXMucHNldWRvRXJyb3JJZCA9IG9wdGlvbnMucHNldWRvRXJyb3JJZCB8fCAnY2hhdC13aWRnZXQtcHNldWRvLWVycm9yJztcbiAgICAgICAgdGhpcy5tZXNzYWdlc0NvbnRhaW5lcklkID0gb3B0aW9ucy5tZXNzYWdlc0NvbnRhaW5lcklkIHx8ICdjaGF0LXdpZGdldC1tZXNzYWdlcyc7XG4gICAgICAgIHRoaXMuaW5wdXRJZCA9IG9wdGlvbnMuaW5wdXRJZCB8fCAnY2hhdC13aWRnZXQtaW5wdXQnO1xuICAgICAgICB0aGlzLnNlbmRCdXR0b25JZCA9IG9wdGlvbnMuc2VuZEJ1dHRvbklkIHx8ICdjaGF0LXdpZGdldC1zZW5kJztcbiAgICAgICAgdGhpcy5jbGVhckNoYXRCdG5JZCA9IG9wdGlvbnMuY2xlYXJDaGF0QnRuSWQgfHwgJ2NoYXQtd2lkZ2V0LWNsZWFyJztcbiAgICAgICAgXG4gICAgICAgIC8vIFNlcnZlciBVUkwgZm9yIHJlbW90ZSBjb21tdW5pY2F0aW9uXG4gICAgICAgIHRoaXMuc2VydmVyVXJsID0gb3B0aW9ucy5zZXJ2ZXJVcmwgfHwgJ2h0dHA6Ly9sb2NhbGhvc3Q6ODA2MCc7XG4gICAgICAgIFxuICAgICAgICAvLyBXZWJTb2NrZXRcbiAgICAgICAgdGhpcy53ZWJTb2NrZXQgPSBuZXcgQ2hhdFdlYlNvY2tldCh7IHNlcnZlclVybDogdGhpcy5zZXJ2ZXJVcmwgfSk7XG4gICAgICAgIFxuICAgICAgICAvLyDDiXRhdFxuICAgICAgICB0aGlzLnBzZXVkbyA9IHRoaXMubG9hZFBzZXVkbygpO1xuICAgICAgICB0aGlzLm1lc3NhZ2VzID0gW107XG4gICAgICAgIHRoaXMudXNlckNvdW50ID0gMDtcbiAgICAgICAgdGhpcy5jb25uZWN0ZWRVc2VycyA9IFtdO1xuICAgICAgICB0aGlzLnNlY3VyaXR5Q29uZmlnID0gb3B0aW9ucy5zZWN1cml0eUNvbmZpZyB8fCB7fTtcbiAgICAgICAgXG4gICAgICAgIC8vIEluaXRpYWxpc2VyIENoYXRTZWN1cml0eU1hbmFnZXJcbiAgICAgICAgdGhpcy5zZWN1cml0eU1hbmFnZXIgPSBuZXcgQ2hhdFNlY3VyaXR5TWFuYWdlcih0aGlzLnNlY3VyaXR5Q29uZmlnKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnNvbGUubG9nKCfwn5SnIENoYXRNYW5hZ2VyOiBDb25zdHJ1Y3Rpb24gZmluaWUsIGluaXQoKS4uLicpO1xuICAgICAgICB0aGlzLmluaXQoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXNlciBsZSBDaGF0TWFuYWdlclxuICAgICAqL1xuICAgIGFzeW5jIGluaXQoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCfwn5qAIENoYXRNYW5hZ2VyOiBpbml0KCkgYXBwZWzDqScpO1xuICAgICAgICBcbiAgICAgICAgLy8gw4ljb3V0ZXIgbGVzIGNoYW5nZW1lbnRzIGQnYXV0aGVudGlmaWNhdGlvblxuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignYXV0aC1jaGFuZ2UnLCAoZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdXNlciA9IGUuZGV0YWlsPy51c2VyO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ/CflIQgQ2hhdE1hbmFnZXI6IEF1dGggY2hhbmdlZDonLCB1c2VyKTtcbiAgICAgICAgICAgIHRoaXMucHNldWRvID0gdXNlciA/IHVzZXIudXNlcm5hbWUgOiBudWxsO1xuICAgICAgICAgICAgdGhpcy5kaXNwbGF5UHNldWRvKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmICh0aGlzLnBzZXVkbyAmJiB0aGlzLndlYlNvY2tldC5pc0Nvbm5lY3RlZCgpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy53ZWJTb2NrZXQuc2V0UHNldWRvKHRoaXMucHNldWRvKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICAvLyBBZmZpY2hlciBsZSBwc2V1ZG9cbiAgICAgICAgdGhpcy5kaXNwbGF5UHNldWRvKCk7XG4gICAgICAgIFxuICAgICAgICAvLyBBZmZpY2hlciBsZXMgbWVzc2FnZXNcbiAgICAgICAgY29uc29sZS5sb2coJ/Cfk4ogQXZhbnQgcmVuZGVyTWVzc2FnZXM6JywgeyBjb250YWluZXI6ICEhZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5tZXNzYWdlc0NvbnRhaW5lcklkKSwgbWVzc2FnZXM6IHRoaXMubWVzc2FnZXMubGVuZ3RoIH0pO1xuICAgICAgICB0aGlzLnJlbmRlck1lc3NhZ2VzKCk7XG4gICAgICAgIFxuICAgICAgICAvLyBBdHRhY2hlciBsZXMgw6ljb3V0ZXVycyBkJ8OpdsOpbmVtZW50c1xuICAgICAgICB0aGlzLmF0dGFjaEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgICAgIFxuICAgICAgICAvLyBBdHRlbmRyZSBxdWUgbGUgV2ViU29ja2V0IHNvaXQgY29ubmVjdMOpLCBwdWlzIGVudm95ZXIgbGUgcHNldWRvIHMnaWwgZXhpc3RlXG4gICAgICAgIGNvbnN0IGNvbm5lY3RBbmRSZXN0b3JlU2Vzc2lvbiA9ICgpID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLndlYlNvY2tldC5pc0Nvbm5lY3RlZCgpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucHNldWRvKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfinKggUmVjb25uZXhpb24gYXV0b21hdGlxdWUgYXZlYyBwc2V1ZG86JywgdGhpcy5wc2V1ZG8pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLndlYlNvY2tldC5zZXRQc2V1ZG8odGhpcy5wc2V1ZG8pLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyZXVyIHJlY29ubmV4aW9uOicsIGVycik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gQXR0ZW5kcmUgdW4gcGV1IGV0IHLDqWVzc2F5ZXJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGNvbm5lY3RBbmRSZXN0b3JlU2Vzc2lvbiwgNTAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIC8vIFbDqXJpZmllciBsYSBjb25uZXhpb25cbiAgICAgICAgY29ubmVjdEFuZFJlc3RvcmVTZXNzaW9uKCk7XG4gICAgICAgIFxuICAgICAgICAvLyDDiWNvdXRlciBsZXMgbWVzc2FnZXMgV2ViU29ja2V0XG4gICAgICAgIHRoaXMud2ViU29ja2V0Lm9uTWVzc2FnZSgoZGF0YSkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ/Cfk6ggTWVzc2FnZSBXZWJTb2NrZXQgcmXDp3U6JywgZGF0YS50eXBlLCBkYXRhKTtcbiAgICAgICAgICAgIGlmIChkYXRhLnR5cGUgPT09ICdoaXN0b3J5Jykge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfwn5OcIEhpc3RvcmlxdWUgcmXDp3U6JywgZGF0YS5tZXNzYWdlcz8ubGVuZ3RoIHx8IDAsICdtZXNzYWdlcycpO1xuICAgICAgICAgICAgICAgIHRoaXMubWVzc2FnZXMgPSBkYXRhLm1lc3NhZ2VzLm1hcChtc2cgPT4gKHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IG1zZy5pZCxcbiAgICAgICAgICAgICAgICAgICAgcHNldWRvOiBtc2cucHNldWRvLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiBtc2cubWVzc2FnZSxcbiAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiB0aGlzLmZvcm1hdFRpbWUobXNnLmNyZWF0ZWRfYXQpLFxuICAgICAgICAgICAgICAgICAgICBvd246IG1zZy5wc2V1ZG8gPT09IHRoaXMucHNldWRvLFxuICAgICAgICAgICAgICAgICAgICBjcmVhdGVkX2F0OiBtc2cuY3JlYXRlZF9hdFxuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlck1lc3NhZ2VzKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxUb0JvdHRvbSgpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChkYXRhLnR5cGUgPT09ICduZXdNZXNzYWdlJykge1xuICAgICAgICAgICAgICAgIGNvbnN0IG1zZyA9IGRhdGEubWVzc2FnZTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn8J+SrCBOb3V2ZWF1IG1lc3NhZ2U6JywgbXNnKTtcbiAgICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2VzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBpZDogbXNnLmlkLFxuICAgICAgICAgICAgICAgICAgICBwc2V1ZG86IG1zZy5wc2V1ZG8sXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IG1zZy5tZXNzYWdlLFxuICAgICAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IHRoaXMuZm9ybWF0VGltZShtc2cuY3JlYXRlZF9hdCksXG4gICAgICAgICAgICAgICAgICAgIG93bjogbXNnLnBzZXVkbyA9PT0gdGhpcy5wc2V1ZG8sXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRfYXQ6IG1zZy5jcmVhdGVkX2F0XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ/Cfk50gTWVzc2FnZXMgYXByw6hzIGFqb3V0OicsIHRoaXMubWVzc2FnZXMubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlck1lc3NhZ2VzKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxUb0JvdHRvbSgpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChkYXRhLnR5cGUgPT09ICd1c2VyQ291bnQnKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ/CfkaUgTWlzZSDDoCBqb3VyIHV0aWxpc2F0ZXVyczonLCBkYXRhLmNvdW50LCBkYXRhLnVzZXJzKTtcbiAgICAgICAgICAgICAgICB0aGlzLnVzZXJDb3VudCA9IGRhdGEuY291bnQ7XG4gICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0ZWRVc2VycyA9IGRhdGEudXNlcnM7XG4gICAgICAgICAgICAgICAgLy8gTWV0dHJlIMOgIGpvdXIgbCdhZmZpY2hhZ2UgZHUgY29tcHRldXIgZCd1dGlsaXNhdGV1cnNcbiAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXlQc2V1ZG8oKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YS50eXBlID09PSAnY2hhdENsZWFyZWQnKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ/Cfl5HvuI8gQ2hhdCBzdXBwcmltw6kgcGFyOicsIGRhdGEuY2xlYXJlZEJ5KTtcbiAgICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2VzID0gW107XG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJNZXNzYWdlcygpO1xuICAgICAgICAgICAgICAgIC8vIEFmZmljaGVyIHVuIG1lc3NhZ2UgZGUgbm90aWZpY2F0aW9uXG4gICAgICAgICAgICAgICAgY29uc3Qgbm90aWZFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5tZXNzYWdlc0NvbnRhaW5lcklkKTtcbiAgICAgICAgICAgICAgICBpZiAobm90aWZFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vdGlmID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICAgICAgICAgIG5vdGlmLmNsYXNzTmFtZSA9ICdjaGF0LWNsZWFyLW5vdGlmaWNhdGlvbic7XG4gICAgICAgICAgICAgICAgICAgIG5vdGlmLnRleHRDb250ZW50ID0gYPCfl5HvuI8gQ2hhdCBzdXBwcmltw6kgcGFyICR7ZGF0YS5jbGVhcmVkQnl9YDtcbiAgICAgICAgICAgICAgICAgICAgbm90aWYuc3R5bGUuY3NzVGV4dCA9ICd0ZXh0LWFsaWduOiBjZW50ZXI7IHBhZGRpbmc6IDEwcHg7IGJhY2tncm91bmQ6ICNmZmU2ZTY7IGNvbG9yOiAjY2MwMDAwOyBib3JkZXItcmFkaXVzOiA0cHg7IG1hcmdpbjogMTBweDsgZm9udC13ZWlnaHQ6IGJvbGQ7JztcbiAgICAgICAgICAgICAgICAgICAgbm90aWZFbGVtZW50LmFwcGVuZENoaWxkKG5vdGlmKTtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiBub3RpZi5yZW1vdmUoKSwgMzAwMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIHRoaXMud2ViU29ja2V0Lm9uRXJyb3IoKGVycikgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycmV1ciBjaGF0OicsIGVycik7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEF0dGFjaGVyIGxlcyDDqWNvdXRldXJzIGQnw6l2w6luZW1lbnRzXG4gICAgICovXG4gICAgYXR0YWNoRXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgICAgIC8vIEJvdXRvbiBkJ2Vudm9pIGRlIG1lc3NhZ2VcbiAgICAgICAgY29uc3Qgc2VuZEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMuc2VuZEJ1dHRvbklkKTtcbiAgICAgICAgaWYgKHNlbmRCdG4pIHtcbiAgICAgICAgICAgIHNlbmRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB0aGlzLnNlbmRNZXNzYWdlKCkpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBCb3V0b24gZGUgbmV0dG95YWdlIGR1IGNoYXRcbiAgICAgICAgY29uc3QgY2xlYXJCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLmNsZWFyQ2hhdEJ0bklkKTtcbiAgICAgICAgaWYgKGNsZWFyQnRuKSB7XG4gICAgICAgICAgICBjbGVhckJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHRoaXMuc2hvd0NsZWFyTW9kYWwoKSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIEJvdXRvbiBkZSBjb25maXJtYXRpb24gZHUgY2xlYXJcbiAgICAgICAgY29uc3QgY2xlYXJDb25maXJtQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYXQtd2lkZ2V0LWNsZWFyLWNvbmZpcm0nKTtcbiAgICAgICAgaWYgKGNsZWFyQ29uZmlybUJ0bikge1xuICAgICAgICAgICAgY2xlYXJDb25maXJtQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gdGhpcy5jb25maXJtQ2xlYXJDaGF0KCkpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBCb3V0b24gZCdhbm51bGF0aW9uIGR1IGNsZWFyXG4gICAgICAgIGNvbnN0IGNsZWFyQ2FuY2VsQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYXQtd2lkZ2V0LWNsZWFyLWNhbmNlbCcpO1xuICAgICAgICBpZiAoY2xlYXJDYW5jZWxCdG4pIHtcbiAgICAgICAgICAgIGNsZWFyQ2FuY2VsQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gdGhpcy5oaWRlQ2xlYXJNb2RhbCgpKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoYXJnZXIgbGUgcHNldWRvIGRlcHVpcyBsYSBzZXNzaW9uIHV0aWxpc2F0ZXVyXG4gICAgICovXG4gICAgbG9hZFBzZXVkbygpIHtcbiAgICAgICAgY29uc3QgdXNlcm5hbWUgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnd29ya3NwYWNlX3VzZXJuYW1lJyk7XG4gICAgICAgIHJldHVybiB1c2VybmFtZSB8fCBudWxsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNhdXZlZ2FyZGVyIGxlIHBzZXVkbyAobm9uIHV0aWxpc8OpLCBsZWN0dXJlIHNldWxlIGRlcHVpcyBzZXNzaW9uKVxuICAgICAqL1xuICAgIHNhdmVQc2V1ZG8ocHNldWRvKSB7XG4gICAgICAgIHRoaXMucHNldWRvID0gcHNldWRvO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbmZpcm1lciBsZSBwc2V1ZG8gKG5vbiB1dGlsaXPDqSwgdXNlcm5hbWUgdmllbnQgZGUgbGEgc2Vzc2lvbilcbiAgICAgKi9cbiAgICBjb25maXJtUHNldWRvKCkge1xuICAgICAgICBjb25zdCB1c2VybmFtZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd3b3Jrc3BhY2VfdXNlcm5hbWUnKTtcbiAgICAgICAgaWYgKCF1c2VybmFtZSkge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCfimqDvuI8gQXVjdW4gdXRpbGlzYXRldXIgY29ubmVjdMOpJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHRoaXMuc2F2ZVBzZXVkbyh1c2VybmFtZSk7XG4gICAgICAgIFxuICAgICAgICBpZiAodGhpcy53ZWJTb2NrZXQuaXNDb25uZWN0ZWQoKSkge1xuICAgICAgICAgICAgdGhpcy53ZWJTb2NrZXQuc2V0UHNldWRvKHVzZXJuYW1lKS5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJldXIgbG9ycyBkZSBsXFwnZW52b2kgZHUgcHNldWRvOicsIGVycik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgdGhpcy5tZXNzYWdlcy5mb3JFYWNoKG1zZyA9PiB7XG4gICAgICAgICAgICBtc2cub3duID0gbXNnLnBzZXVkbyA9PT0gdGhpcy5wc2V1ZG87XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgdGhpcy5kaXNwbGF5UHNldWRvKCk7XG4gICAgICAgIHRoaXMucmVuZGVyTWVzc2FnZXMoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBZmZpY2hlciBsZSBwc2V1ZG8gYXZlYyBjb21wdGV1ciBkJ3V0aWxpc2F0ZXVyc1xuICAgICAqL1xuICAgIGRpc3BsYXlQc2V1ZG8oKSB7XG4gICAgICAgIGNvbnN0IHBzZXVkb0Rpc3BsYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLnBzZXVkb0Rpc3BsYXlJZCk7XG4gICAgICAgIFxuICAgICAgICBpZiAoIXBzZXVkb0Rpc3BsYXkpIHJldHVybjtcbiAgICAgICAgXG4gICAgICAgIGlmICh0aGlzLnBzZXVkbykge1xuICAgICAgICAgICAgY29uc3QgZGlzcGxheUNvdW50ID0gdGhpcy51c2VyQ291bnQgPiAwID8gdGhpcy51c2VyQ291bnQgOiAwO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBwc2V1ZG9EaXNwbGF5LmlubmVySFRNTCA9IGBcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY2hhdC1wc2V1ZG8tY29uZmlybWVkXCI+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjaGF0LXBzZXVkby1pbmZvXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz1cImZhcyBmYS11c2VyXCI+PC9pPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4+JHt0aGlzLmVzY2FwZUh0bWwodGhpcy5wc2V1ZG8pfTwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjaGF0LXVzZXItY291bnRcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPVwiZmFzIGZhLXVzZXJzXCI+PC9pPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4+JHtkaXNwbGF5Q291bnR9PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIGA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwc2V1ZG9EaXNwbGF5LmlubmVySFRNTCA9IGBcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY2hhdC1wc2V1ZG8tcmVxdWlyZWRcIj5cbiAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9XCJmYXMgZmEtZXhjbGFtYXRpb24tY2lyY2xlXCI+PC9pPlxuICAgICAgICAgICAgICAgICAgICA8c3Bhbj5Db25uZWN0ZXotdm91cyBwb3VyIHV0aWxpc2VyIGxlIGNoYXQ8L3NwYW4+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICBgO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRW52b3llciB1biBtZXNzYWdlIHZpYSBXZWJTb2NrZXRcbiAgICAgKi9cbiAgICBhc3luYyBzZW5kTWVzc2FnZSgpIHtcbiAgICAgICAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLmlucHV0SWQpO1xuICAgICAgICBpZiAoIWlucHV0KSByZXR1cm47XG4gICAgICAgIFxuICAgICAgICBjb25zdCB0ZXh0ID0gaW5wdXQudmFsdWUudHJpbSgpO1xuICAgICAgICBcbiAgICAgICAgaWYgKCF0ZXh0KSByZXR1cm47XG4gICAgICAgIGlmICghdGhpcy5wc2V1ZG8pIHtcbiAgICAgICAgICAgIGFsZXJ0KCdWb3VzIGRldmV6IMOqdHJlIGNvbm5lY3TDqSBwb3VyIGVudm95ZXIgZGVzIG1lc3NhZ2VzJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmICh0ZXh0Lmxlbmd0aCA+IDUwMDApIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2Fybign4pqg77iPIE1lc3NhZ2UgdHJvcCBsb25nJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMud2ViU29ja2V0LmlzQ29ubmVjdGVkKCkpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgV2ViU29ja2V0IG5vbiBjb25uZWN0w6knKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IHRoaXMud2ViU29ja2V0LnNlbmRNZXNzYWdlKHRoaXMucHNldWRvLCB0ZXh0KTtcbiAgICAgICAgICAgIGlucHV0LnZhbHVlID0gJyc7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyZXVyIGVudm9pIG1lc3NhZ2U6JywgZXJyb3IpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRMOpbWFycmVyIGxlIHBvbGxpbmcgZGVzIG5vdXZlYXV4IG1lc3NhZ2VzXG4gICAgICovXG4gICAgLyoqXG4gICAgICogQWZmaWNoZXIgbGVzIG1lc3NhZ2VzXG4gICAgICovXG4gICAgcmVuZGVyTWVzc2FnZXMoKSB7XG4gICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMubWVzc2FnZXNDb250YWluZXJJZCk7XG4gICAgICAgIGNvbnNvbGUubG9nKCfwn46oIHJlbmRlck1lc3NhZ2VzIGFwcGVsw6knLCB7IGNvbnRhaW5lcjogISFjb250YWluZXIsIG1lc3NhZ2VzQ291bnQ6IHRoaXMubWVzc2FnZXMubGVuZ3RoLCBjb250YWluZXJJZDogdGhpcy5tZXNzYWdlc0NvbnRhaW5lcklkIH0pO1xuICAgICAgICBpZiAoIWNvbnRhaW5lcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcign4p2MIENvbnRhaW5lciBwYXMgdHJvdXbDqTonLCB0aGlzLm1lc3NhZ2VzQ29udGFpbmVySWQpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZiAodGhpcy5tZXNzYWdlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz1cImNoYXQtd2lkZ2V0LWVtcHR5XCI+QXVjdW4gbWVzc2FnZSBwb3VyIGxlIG1vbWVudDwvZGl2Pic7XG4gICAgICAgICAgICBjb250YWluZXIuY2xhc3NOYW1lID0gJ2NoYXQtd2lkZ2V0LWVtcHR5JztcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gUmV0aXJlciBsYSBjbGFzc2UgZW1wdHkgc2kgZWxsZSBleGlzdGVcbiAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2NoYXQtd2lkZ2V0LWVtcHR5Jyk7XG4gICAgICAgIFxuICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gdGhpcy5tZXNzYWdlcy5tYXAobXNnID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNsYXNzTmFtZSA9IG1zZy5vd24gPyAnY2hhdC1tZXNzYWdlIG93bicgOiAnY2hhdC1tZXNzYWdlIG90aGVyJztcbiAgICAgICAgICAgIGNvbnN0IHNhbml0aXplZCA9IHRoaXMuc2FuaXRpemVNZXNzYWdlKG1zZy50ZXh0KTtcbiAgICAgICAgICAgIHJldHVybiBgXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cIiR7Y2xhc3NOYW1lfVwiPlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY2hhdC1tZXNzYWdlLXBzZXVkb1wiPiR7dGhpcy5zYW5pdGl6ZU1lc3NhZ2UobXNnLnBzZXVkbyl9PC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjaGF0LW1lc3NhZ2UtY29udGVudFwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNoYXQtbWVzc2FnZS10ZXh0XCI+JHtzYW5pdGl6ZWR9PC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY2hhdC1tZXNzYWdlLXRpbWVcIj4ke21zZy50aW1lc3RhbXB9PC9kaXY+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICBgO1xuICAgICAgICB9KS5qb2luKCcnKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnNvbGUubG9nKCfinIUgTWVzc2FnZXMgcmVuZHVzOicsIHRoaXMubWVzc2FnZXMubGVuZ3RoKTtcbiAgICAgICAgLy8gU2Nyb2xsIHZlcnMgbGUgYmFzXG4gICAgICAgIHRoaXMuc2Nyb2xsVG9Cb3R0b20oKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBZmZpY2hlciBsYSBtb2RhbCBkZSBjb25maXJtYXRpb24gZHUgY2xlYXJcbiAgICAgKi9cbiAgICBzaG93Q2xlYXJNb2RhbCgpIHtcbiAgICAgICAgY29uc3QgY2xlYXJNb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGF0LXdpZGdldC1jbGVhci1tb2RhbCcpO1xuICAgICAgICBpZiAoY2xlYXJNb2RhbCkge1xuICAgICAgICAgICAgY2xlYXJNb2RhbC5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNYXNxdWVyIGxhIG1vZGFsIGRlIGNvbmZpcm1hdGlvbiBkdSBjbGVhclxuICAgICAqL1xuICAgIGhpZGVDbGVhck1vZGFsKCkge1xuICAgICAgICBjb25zdCBjbGVhck1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYXQtd2lkZ2V0LWNsZWFyLW1vZGFsJyk7XG4gICAgICAgIGlmIChjbGVhck1vZGFsKSB7XG4gICAgICAgICAgICBjbGVhck1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbmZpcm1lciBldCBleMOpY3V0ZXIgbGUgY2xlYXIgZHUgY2hhdFxuICAgICAqL1xuICAgIGFzeW5jIGNvbmZpcm1DbGVhckNoYXQoKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBwc2V1ZG8gPSB0aGlzLmNoYXRXZWJTb2NrZXQ/LnVzZXJQc2V1ZG8gfHwgbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3VzZXJQc2V1ZG8nKSB8fCAnVW5rbm93bic7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEVudm95ZXIgbGUgbWVzc2FnZSBXZWJTb2NrZXQgcG91ciBzdXBwcmltZXIgbGUgY2hhdFxuICAgICAgICAgICAgdGhpcy5jaGF0V2ViU29ja2V0Py53cz8uc2VuZChKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgdHlwZTogJ2NsZWFyQ2hhdCcsXG4gICAgICAgICAgICAgICAgcHNldWRvOiBwc2V1ZG9cbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbG9nZ2VyLmluZm8oYOKchSBEZW1hbmRlIGRlIHN1cHByZXNzaW9uIGR1IGNoYXQgZW52b3nDqWVgKTtcbiAgICAgICAgICAgIHRoaXMuaGlkZUNsZWFyTW9kYWwoKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJldXIgc3VwcHJlc3Npb24gY2hhdDonLCBlcnJvcik7XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoYOKdjCBFcnJldXIgbG9ycyBkZSBsYSBzdXBwcmVzc2lvbjogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2Nyb2xsIHZlcnMgbGUgYmFzIGR1IGNoYXRcbiAgICAgKi9cbiAgICBzY3JvbGxUb0JvdHRvbSgpIHtcbiAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5tZXNzYWdlc0NvbnRhaW5lcklkKTtcbiAgICAgICAgaWYgKGNvbnRhaW5lcikge1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyLnNjcm9sbFRvcCA9IGNvbnRhaW5lci5zY3JvbGxIZWlnaHQ7XG4gICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE5ldHRveWVyIGxlcyBtZXNzYWdlcyBYU1NcbiAgICAgKi9cbiAgICBzYW5pdGl6ZU1lc3NhZ2UodGV4dCkge1xuICAgICAgICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgZGl2LnRleHRDb250ZW50ID0gdGV4dDtcbiAgICAgICAgcmV0dXJuIGRpdi5pbm5lckhUTUw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRm9ybWF0ZXIgbCdoZXVyZVxuICAgICAqL1xuICAgIGZvcm1hdFRpbWUoaXNvU3RyaW5nKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoaXNvU3RyaW5nKTtcbiAgICAgICAgICAgIHJldHVybiBkYXRlLnRvTG9jYWxlVGltZVN0cmluZygnZnItRlInLCB7IFxuICAgICAgICAgICAgICAgIGhvdXI6ICcyLWRpZ2l0JywgXG4gICAgICAgICAgICAgICAgbWludXRlOiAnMi1kaWdpdCcgXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKCkudG9Mb2NhbGVUaW1lU3RyaW5nKCdmci1GUicsIHsgXG4gICAgICAgICAgICAgICAgaG91cjogJzItZGlnaXQnLCBcbiAgICAgICAgICAgICAgICBtaW51dGU6ICcyLWRpZ2l0JyBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGVzdHJ1Y3RvciAtIG5ldHRveWVyIHF1YW5kIGxlIHdpZGdldCBlc3QgZmVybcOpXG4gICAgICovXG4gICAgZGVzdHJveSgpIHtcbiAgICAgICAgLy8gV2ViU29ja2V0IHNlIGZlcm1lIGF1dG9tYXRpcXVlbWVudFxuICAgICAgICBpZiAodGhpcy53ZWJTb2NrZXQpIHtcbiAgICAgICAgICAgIHRoaXMud2ViU29ja2V0LmRpc2Nvbm5lY3Q/LigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZXNjYXBlSHRtbCh0ZXh0KSB7XG4gICAgICAgIGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBkaXYudGV4dENvbnRlbnQgPSB0ZXh0O1xuICAgICAgICByZXR1cm4gZGl2LmlubmVySFRNTDtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IENoYXRNYW5hZ2VyO1xuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./public/assets/js/modules/chat/ChatManager.js\n\n}");

/***/ }),

/***/ "./public/assets/js/modules/chat/ChatSecurityManager.js":
/*!**************************************************************!*\
  !*** ./public/assets/js/modules/chat/ChatSecurityManager.js ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/**\n * ChatSecurityManager - Gestion s√©curis√©e des liens dans le chat\n * \n * D√©tecte et rend cliquables les liens URL tout en emp√™chant les attaques XSS.\n * Supporte whitelist/blacklist de domaines et mots-cl√©s interdits.\n */\n\nclass ChatSecurityManager {\n    constructor(options = {}) {\n        // Configuration\n        this.strictMode = options.strictMode || false; // true = whitelist only\n        this.allowedDomains = options.allowedDomains || [];\n        this.blockedDomains = options.blockedDomains || [];\n        this.blockedKeywords = options.blockedKeywords || [];\n        this.allowedProtocols = options.allowedProtocols || ['http', 'https', 'mailto', 'ftp'];\n        \n        // Regex pour d√©tecter les URLs\n        this.urlRegex = /(\bhttps?:\\/\\/[^\\s<>\"\\)]+|www\\.[^\\s<>\"\\)]+\\.[a-z]{2,}|[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,})/gi;\n    }\n\n    /**\n     * Ajouter un domaine √† la blacklist\n     */\n    addBlockedDomain(domain) {\n        if (!this.blockedDomains.includes(domain)) {\n            this.blockedDomains.push(domain);\n        }\n    }\n\n    /**\n     * Ajouter un mot-cl√© √† la blacklist\n     */\n    addBlockedKeyword(keyword) {\n        if (!this.blockedKeywords.includes(keyword.toLowerCase())) {\n            this.blockedKeywords.push(keyword.toLowerCase());\n        }\n    }\n\n    /**\n     * V√©rifier si un message contient des mots-cl√©s interdits\n     */\n    containsBlockedKeyword(text) {\n        const lowerText = text.toLowerCase();\n        return this.blockedKeywords.some(keyword => lowerText.includes(keyword));\n    }\n\n    /**\n     * Valider une URL\n     */\n    isValidUrl(urlString) {\n        try {\n            // Ajouter protocole si manquant\n            let url = urlString;\n            if (!url.match(/^[a-z][a-z0-9+.-]*:/i)) {\n                url = 'https://' + url;\n            }\n\n            const urlObj = new URL(url);\n            \n            // V√©rifier le protocole\n            const protocol = urlObj.protocol.replace(':', '');\n            if (!this.allowedProtocols.includes(protocol)) {\n                console.warn(`‚ö†Ô∏è Protocole non autoris√©: ${protocol}`);\n                return false;\n            }\n\n            // V√©rifier les domaines\n            const hostname = urlObj.hostname.toLowerCase();\n            \n            if (this.strictMode) {\n                // Mode whitelist : seuls les domaines autoris√©s\n                return this.allowedDomains.some(domain => \n                    hostname === domain || hostname.endsWith('.' + domain)\n                );\n            } else {\n                // Mode blacklist : tous sauf ceux bloqu√©s\n                const isBlocked = this.blockedDomains.some(domain =>\n                    hostname === domain || hostname.endsWith('.' + domain)\n                );\n                return !isBlocked;\n            }\n        } catch (error) {\n            console.warn(`‚ö†Ô∏è URL invalide: ${urlString}`, error.message);\n            return false;\n        }\n    }\n\n    /**\n     * Cr√©er un √©l√©ment lien s√©curis√©\n     */\n    createSafeLink(urlString) {\n        // Cr√©er un bouton stylis√© comme un lien au lieu d'un <a>\n        // Cela √©vite les probl√®mes de href et garantit que le click fonctionne\n        const button = document.createElement('button');\n        \n        // Normaliser l'URL\n        let url = urlString;\n        if (!url.match(/^[a-z][a-z0-9+.-]*:/i)) {\n            url = 'https://' + url;\n        }\n        \n        button.type = 'button';\n        button.textContent = urlString;\n        button.className = 'chat-link';\n        \n        // Au clic, ouvrir dans le navigateur syst√®me\n        button.addEventListener('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            \n            // Utiliser l'API Electron pour ouvrir dans le navigateur par d√©faut\n            if (window.electron && typeof window.electron.openExternal === 'function') {\n                window.electron.openExternal(url);\n            } else {\n                console.warn('‚ö†Ô∏è window.electron.openExternal non disponible');\n            }\n            \n            return false;\n        });\n        \n        return button;\n    }\n\n    /**\n     * Traiter un message et rendre les liens cliquables\n     * Retourne un DocumentFragment contenant les √©l√©ments DOM\n     */\n    processMessage(text) {\n        if (!text) {\n            const fragment = document.createDocumentFragment();\n            fragment.appendChild(document.createTextNode(text));\n            return fragment;\n        }\n\n        // V√©rifier les mots-cl√©s bloqu√©s\n        if (this.containsBlockedKeyword(text)) {\n            console.warn(`‚ö†Ô∏è Message contient un mot-cl√© bloqu√©`);\n            const fragment = document.createDocumentFragment();\n            fragment.appendChild(document.createTextNode(text));\n            return fragment; // Retourner le texte brut sans liens\n        }\n\n        // Cr√©er un fragment pour ins√©rer le contenu\n        const fragment = document.createDocumentFragment();\n        \n        // Diviser le texte par les URLs d√©tect√©es\n        let lastIndex = 0;\n        let match;\n\n        while ((match = this.urlRegex.exec(text)) !== null) {\n            const url = match[0];\n            \n            // Ajouter le texte avant l'URL\n            if (match.index > lastIndex) {\n                const textNode = document.createTextNode(text.substring(lastIndex, match.index));\n                fragment.appendChild(textNode);\n            }\n\n            // V√©rifier si l'URL est valide\n            if (this.isValidUrl(url)) {\n                const link = this.createSafeLink(url);\n                fragment.appendChild(link);\n            } else {\n                // Si l'URL n'est pas valide, ajouter le texte brut\n                const textNode = document.createTextNode(url);\n                fragment.appendChild(textNode);\n            }\n\n            lastIndex = match.index + url.length;\n        }\n\n        // Ajouter le texte restant\n        if (lastIndex < text.length) {\n            const textNode = document.createTextNode(text.substring(lastIndex));\n            fragment.appendChild(textNode);\n        }\n\n        // Retourner le fragment contenant les √©l√©ments DOM\n        return fragment;\n    }\n\n    /**\n     * Exporter la configuration en JSON\n     */\n    exportConfig() {\n        return {\n            strictMode: this.strictMode,\n            allowedDomains: this.allowedDomains,\n            blockedDomains: this.blockedDomains,\n            blockedKeywords: this.blockedKeywords,\n            allowedProtocols: this.allowedProtocols\n        };\n    }\n\n    /**\n     * Importer une configuration depuis JSON\n     */\n    importConfig(config) {\n        if (config.strictMode !== undefined) this.strictMode = config.strictMode;\n        if (config.allowedDomains) this.allowedDomains = config.allowedDomains;\n        if (config.blockedDomains) this.blockedDomains = config.blockedDomains;\n        if (config.blockedKeywords) this.blockedKeywords = config.blockedKeywords;\n        if (config.allowedProtocols) this.allowedProtocols = config.allowedProtocols;\n    }\n}\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ChatSecurityManager);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wdWJsaWMvYXNzZXRzL2pzL21vZHVsZXMvY2hhdC9DaGF0U2VjdXJpdHlNYW5hZ2VyLmpzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSw0QkFBNEI7QUFDNUI7QUFDQSx1REFBdUQ7QUFDdkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEVBQTBFLEdBQUcsNENBQTRDLEdBQUc7QUFDNUg7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyREFBMkQsU0FBUztBQUNwRTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWLDZDQUE2QyxVQUFVO0FBQ3ZEO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsaUVBQWUsbUJBQW1CLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93b3Jrc3BhY2UtY2xpZW50Ly4vcHVibGljL2Fzc2V0cy9qcy9tb2R1bGVzL2NoYXQvQ2hhdFNlY3VyaXR5TWFuYWdlci5qcz8xMTYyIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ2hhdFNlY3VyaXR5TWFuYWdlciAtIEdlc3Rpb24gc8OpY3VyaXPDqWUgZGVzIGxpZW5zIGRhbnMgbGUgY2hhdFxuICogXG4gKiBEw6l0ZWN0ZSBldCByZW5kIGNsaXF1YWJsZXMgbGVzIGxpZW5zIFVSTCB0b3V0IGVuIGVtcMOqY2hhbnQgbGVzIGF0dGFxdWVzIFhTUy5cbiAqIFN1cHBvcnRlIHdoaXRlbGlzdC9ibGFja2xpc3QgZGUgZG9tYWluZXMgZXQgbW90cy1jbMOpcyBpbnRlcmRpdHMuXG4gKi9cblxuY2xhc3MgQ2hhdFNlY3VyaXR5TWFuYWdlciB7XG4gICAgY29uc3RydWN0b3Iob3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIC8vIENvbmZpZ3VyYXRpb25cbiAgICAgICAgdGhpcy5zdHJpY3RNb2RlID0gb3B0aW9ucy5zdHJpY3RNb2RlIHx8IGZhbHNlOyAvLyB0cnVlID0gd2hpdGVsaXN0IG9ubHlcbiAgICAgICAgdGhpcy5hbGxvd2VkRG9tYWlucyA9IG9wdGlvbnMuYWxsb3dlZERvbWFpbnMgfHwgW107XG4gICAgICAgIHRoaXMuYmxvY2tlZERvbWFpbnMgPSBvcHRpb25zLmJsb2NrZWREb21haW5zIHx8IFtdO1xuICAgICAgICB0aGlzLmJsb2NrZWRLZXl3b3JkcyA9IG9wdGlvbnMuYmxvY2tlZEtleXdvcmRzIHx8IFtdO1xuICAgICAgICB0aGlzLmFsbG93ZWRQcm90b2NvbHMgPSBvcHRpb25zLmFsbG93ZWRQcm90b2NvbHMgfHwgWydodHRwJywgJ2h0dHBzJywgJ21haWx0bycsICdmdHAnXTtcbiAgICAgICAgXG4gICAgICAgIC8vIFJlZ2V4IHBvdXIgZMOpdGVjdGVyIGxlcyBVUkxzXG4gICAgICAgIHRoaXMudXJsUmVnZXggPSAvKFxiaHR0cHM/OlxcL1xcL1teXFxzPD5cIlxcKV0rfHd3d1xcLlteXFxzPD5cIlxcKV0rXFwuW2Etel17Mix9fFthLXpBLVowLTkuXyUrLV0rQFthLXpBLVowLTkuLV0rXFwuW2EtekEtWl17Mix9KS9naTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBam91dGVyIHVuIGRvbWFpbmUgw6AgbGEgYmxhY2tsaXN0XG4gICAgICovXG4gICAgYWRkQmxvY2tlZERvbWFpbihkb21haW4pIHtcbiAgICAgICAgaWYgKCF0aGlzLmJsb2NrZWREb21haW5zLmluY2x1ZGVzKGRvbWFpbikpIHtcbiAgICAgICAgICAgIHRoaXMuYmxvY2tlZERvbWFpbnMucHVzaChkb21haW4pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQWpvdXRlciB1biBtb3QtY2zDqSDDoCBsYSBibGFja2xpc3RcbiAgICAgKi9cbiAgICBhZGRCbG9ja2VkS2V5d29yZChrZXl3b3JkKSB7XG4gICAgICAgIGlmICghdGhpcy5ibG9ja2VkS2V5d29yZHMuaW5jbHVkZXMoa2V5d29yZC50b0xvd2VyQ2FzZSgpKSkge1xuICAgICAgICAgICAgdGhpcy5ibG9ja2VkS2V5d29yZHMucHVzaChrZXl3b3JkLnRvTG93ZXJDYXNlKCkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVsOpcmlmaWVyIHNpIHVuIG1lc3NhZ2UgY29udGllbnQgZGVzIG1vdHMtY2zDqXMgaW50ZXJkaXRzXG4gICAgICovXG4gICAgY29udGFpbnNCbG9ja2VkS2V5d29yZCh0ZXh0KSB7XG4gICAgICAgIGNvbnN0IGxvd2VyVGV4dCA9IHRleHQudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmxvY2tlZEtleXdvcmRzLnNvbWUoa2V5d29yZCA9PiBsb3dlclRleHQuaW5jbHVkZXMoa2V5d29yZCkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFZhbGlkZXIgdW5lIFVSTFxuICAgICAqL1xuICAgIGlzVmFsaWRVcmwodXJsU3RyaW5nKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBBam91dGVyIHByb3RvY29sZSBzaSBtYW5xdWFudFxuICAgICAgICAgICAgbGV0IHVybCA9IHVybFN0cmluZztcbiAgICAgICAgICAgIGlmICghdXJsLm1hdGNoKC9eW2Etel1bYS16MC05Ky4tXSo6L2kpKSB7XG4gICAgICAgICAgICAgICAgdXJsID0gJ2h0dHBzOi8vJyArIHVybDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgdXJsT2JqID0gbmV3IFVSTCh1cmwpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBWw6lyaWZpZXIgbGUgcHJvdG9jb2xlXG4gICAgICAgICAgICBjb25zdCBwcm90b2NvbCA9IHVybE9iai5wcm90b2NvbC5yZXBsYWNlKCc6JywgJycpO1xuICAgICAgICAgICAgaWYgKCF0aGlzLmFsbG93ZWRQcm90b2NvbHMuaW5jbHVkZXMocHJvdG9jb2wpKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGDimqDvuI8gUHJvdG9jb2xlIG5vbiBhdXRvcmlzw6k6ICR7cHJvdG9jb2x9YCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBWw6lyaWZpZXIgbGVzIGRvbWFpbmVzXG4gICAgICAgICAgICBjb25zdCBob3N0bmFtZSA9IHVybE9iai5ob3N0bmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAodGhpcy5zdHJpY3RNb2RlKSB7XG4gICAgICAgICAgICAgICAgLy8gTW9kZSB3aGl0ZWxpc3QgOiBzZXVscyBsZXMgZG9tYWluZXMgYXV0b3Jpc8Opc1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmFsbG93ZWREb21haW5zLnNvbWUoZG9tYWluID0+IFxuICAgICAgICAgICAgICAgICAgICBob3N0bmFtZSA9PT0gZG9tYWluIHx8IGhvc3RuYW1lLmVuZHNXaXRoKCcuJyArIGRvbWFpbilcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBNb2RlIGJsYWNrbGlzdCA6IHRvdXMgc2F1ZiBjZXV4IGJsb3F1w6lzXG4gICAgICAgICAgICAgICAgY29uc3QgaXNCbG9ja2VkID0gdGhpcy5ibG9ja2VkRG9tYWlucy5zb21lKGRvbWFpbiA9PlxuICAgICAgICAgICAgICAgICAgICBob3N0bmFtZSA9PT0gZG9tYWluIHx8IGhvc3RuYW1lLmVuZHNXaXRoKCcuJyArIGRvbWFpbilcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIHJldHVybiAhaXNCbG9ja2VkO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKGDimqDvuI8gVVJMIGludmFsaWRlOiAke3VybFN0cmluZ31gLCBlcnJvci5tZXNzYWdlKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyw6llciB1biDDqWzDqW1lbnQgbGllbiBzw6ljdXJpc8OpXG4gICAgICovXG4gICAgY3JlYXRlU2FmZUxpbmsodXJsU3RyaW5nKSB7XG4gICAgICAgIC8vIENyw6llciB1biBib3V0b24gc3R5bGlzw6kgY29tbWUgdW4gbGllbiBhdSBsaWV1IGQndW4gPGE+XG4gICAgICAgIC8vIENlbGEgw6l2aXRlIGxlcyBwcm9ibMOobWVzIGRlIGhyZWYgZXQgZ2FyYW50aXQgcXVlIGxlIGNsaWNrIGZvbmN0aW9ubmVcbiAgICAgICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG4gICAgICAgIFxuICAgICAgICAvLyBOb3JtYWxpc2VyIGwnVVJMXG4gICAgICAgIGxldCB1cmwgPSB1cmxTdHJpbmc7XG4gICAgICAgIGlmICghdXJsLm1hdGNoKC9eW2Etel1bYS16MC05Ky4tXSo6L2kpKSB7XG4gICAgICAgICAgICB1cmwgPSAnaHR0cHM6Ly8nICsgdXJsO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBidXR0b24udHlwZSA9ICdidXR0b24nO1xuICAgICAgICBidXR0b24udGV4dENvbnRlbnQgPSB1cmxTdHJpbmc7XG4gICAgICAgIGJ1dHRvbi5jbGFzc05hbWUgPSAnY2hhdC1saW5rJztcbiAgICAgICAgXG4gICAgICAgIC8vIEF1IGNsaWMsIG91dnJpciBkYW5zIGxlIG5hdmlnYXRldXIgc3lzdMOobWVcbiAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFV0aWxpc2VyIGwnQVBJIEVsZWN0cm9uIHBvdXIgb3V2cmlyIGRhbnMgbGUgbmF2aWdhdGV1ciBwYXIgZMOpZmF1dFxuICAgICAgICAgICAgaWYgKHdpbmRvdy5lbGVjdHJvbiAmJiB0eXBlb2Ygd2luZG93LmVsZWN0cm9uLm9wZW5FeHRlcm5hbCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5lbGVjdHJvbi5vcGVuRXh0ZXJuYWwodXJsKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCfimqDvuI8gd2luZG93LmVsZWN0cm9uLm9wZW5FeHRlcm5hbCBub24gZGlzcG9uaWJsZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGJ1dHRvbjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUcmFpdGVyIHVuIG1lc3NhZ2UgZXQgcmVuZHJlIGxlcyBsaWVucyBjbGlxdWFibGVzXG4gICAgICogUmV0b3VybmUgdW4gRG9jdW1lbnRGcmFnbWVudCBjb250ZW5hbnQgbGVzIMOpbMOpbWVudHMgRE9NXG4gICAgICovXG4gICAgcHJvY2Vzc01lc3NhZ2UodGV4dCkge1xuICAgICAgICBpZiAoIXRleHQpIHtcbiAgICAgICAgICAgIGNvbnN0IGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgICAgICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGV4dCkpO1xuICAgICAgICAgICAgcmV0dXJuIGZyYWdtZW50O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVsOpcmlmaWVyIGxlcyBtb3RzLWNsw6lzIGJsb3F1w6lzXG4gICAgICAgIGlmICh0aGlzLmNvbnRhaW5zQmxvY2tlZEtleXdvcmQodGV4dCkpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2Fybihg4pqg77iPIE1lc3NhZ2UgY29udGllbnQgdW4gbW90LWNsw6kgYmxvcXXDqWApO1xuICAgICAgICAgICAgY29uc3QgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0ZXh0KSk7XG4gICAgICAgICAgICByZXR1cm4gZnJhZ21lbnQ7IC8vIFJldG91cm5lciBsZSB0ZXh0ZSBicnV0IHNhbnMgbGllbnNcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENyw6llciB1biBmcmFnbWVudCBwb3VyIGluc8OpcmVyIGxlIGNvbnRlbnVcbiAgICAgICAgY29uc3QgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgICAgIFxuICAgICAgICAvLyBEaXZpc2VyIGxlIHRleHRlIHBhciBsZXMgVVJMcyBkw6l0ZWN0w6llc1xuICAgICAgICBsZXQgbGFzdEluZGV4ID0gMDtcbiAgICAgICAgbGV0IG1hdGNoO1xuXG4gICAgICAgIHdoaWxlICgobWF0Y2ggPSB0aGlzLnVybFJlZ2V4LmV4ZWModGV4dCkpICE9PSBudWxsKSB7XG4gICAgICAgICAgICBjb25zdCB1cmwgPSBtYXRjaFswXTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gQWpvdXRlciBsZSB0ZXh0ZSBhdmFudCBsJ1VSTFxuICAgICAgICAgICAgaWYgKG1hdGNoLmluZGV4ID4gbGFzdEluZGV4KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGV4dE5vZGUgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0ZXh0LnN1YnN0cmluZyhsYXN0SW5kZXgsIG1hdGNoLmluZGV4KSk7XG4gICAgICAgICAgICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQodGV4dE5vZGUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBWw6lyaWZpZXIgc2kgbCdVUkwgZXN0IHZhbGlkZVxuICAgICAgICAgICAgaWYgKHRoaXMuaXNWYWxpZFVybCh1cmwpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbGluayA9IHRoaXMuY3JlYXRlU2FmZUxpbmsodXJsKTtcbiAgICAgICAgICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChsaW5rKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gU2kgbCdVUkwgbidlc3QgcGFzIHZhbGlkZSwgYWpvdXRlciBsZSB0ZXh0ZSBicnV0XG4gICAgICAgICAgICAgICAgY29uc3QgdGV4dE5vZGUgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh1cmwpO1xuICAgICAgICAgICAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKHRleHROb2RlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGFzdEluZGV4ID0gbWF0Y2guaW5kZXggKyB1cmwubGVuZ3RoO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQWpvdXRlciBsZSB0ZXh0ZSByZXN0YW50XG4gICAgICAgIGlmIChsYXN0SW5kZXggPCB0ZXh0Lmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc3QgdGV4dE5vZGUgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0ZXh0LnN1YnN0cmluZyhsYXN0SW5kZXgpKTtcbiAgICAgICAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKHRleHROb2RlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJldG91cm5lciBsZSBmcmFnbWVudCBjb250ZW5hbnQgbGVzIMOpbMOpbWVudHMgRE9NXG4gICAgICAgIHJldHVybiBmcmFnbWVudDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBFeHBvcnRlciBsYSBjb25maWd1cmF0aW9uIGVuIEpTT05cbiAgICAgKi9cbiAgICBleHBvcnRDb25maWcoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdHJpY3RNb2RlOiB0aGlzLnN0cmljdE1vZGUsXG4gICAgICAgICAgICBhbGxvd2VkRG9tYWluczogdGhpcy5hbGxvd2VkRG9tYWlucyxcbiAgICAgICAgICAgIGJsb2NrZWREb21haW5zOiB0aGlzLmJsb2NrZWREb21haW5zLFxuICAgICAgICAgICAgYmxvY2tlZEtleXdvcmRzOiB0aGlzLmJsb2NrZWRLZXl3b3JkcyxcbiAgICAgICAgICAgIGFsbG93ZWRQcm90b2NvbHM6IHRoaXMuYWxsb3dlZFByb3RvY29sc1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEltcG9ydGVyIHVuZSBjb25maWd1cmF0aW9uIGRlcHVpcyBKU09OXG4gICAgICovXG4gICAgaW1wb3J0Q29uZmlnKGNvbmZpZykge1xuICAgICAgICBpZiAoY29uZmlnLnN0cmljdE1vZGUgIT09IHVuZGVmaW5lZCkgdGhpcy5zdHJpY3RNb2RlID0gY29uZmlnLnN0cmljdE1vZGU7XG4gICAgICAgIGlmIChjb25maWcuYWxsb3dlZERvbWFpbnMpIHRoaXMuYWxsb3dlZERvbWFpbnMgPSBjb25maWcuYWxsb3dlZERvbWFpbnM7XG4gICAgICAgIGlmIChjb25maWcuYmxvY2tlZERvbWFpbnMpIHRoaXMuYmxvY2tlZERvbWFpbnMgPSBjb25maWcuYmxvY2tlZERvbWFpbnM7XG4gICAgICAgIGlmIChjb25maWcuYmxvY2tlZEtleXdvcmRzKSB0aGlzLmJsb2NrZWRLZXl3b3JkcyA9IGNvbmZpZy5ibG9ja2VkS2V5d29yZHM7XG4gICAgICAgIGlmIChjb25maWcuYWxsb3dlZFByb3RvY29scykgdGhpcy5hbGxvd2VkUHJvdG9jb2xzID0gY29uZmlnLmFsbG93ZWRQcm90b2NvbHM7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBDaGF0U2VjdXJpdHlNYW5hZ2VyO1xuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./public/assets/js/modules/chat/ChatSecurityManager.js\n\n}");

/***/ }),

/***/ "./public/assets/js/modules/chat/ChatWebSocket.js":
/*!********************************************************!*\
  !*** ./public/assets/js/modules/chat/ChatWebSocket.js ***!
  \********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/**\n * ChatWebSocket - Communication en temps r√©el via WebSocket\n * Remplace le polling HTTP par WebSocket pour plus de r√©activit√©\n */\n\nclass ChatWebSocket {\n    constructor(options = {}) {\n        this.serverUrl = options.serverUrl || 'http://localhost:8060';\n        this.wsUrl = this.buildWebSocketUrl(this.serverUrl);\n        this.ws = null;\n        this.messageHandlers = [];\n        this.errorHandlers = [];\n        this.reconnectAttempts = 0;\n        this.maxReconnectAttempts = 5;\n        this.reconnectDelay = 3000;\n        \n        this.connect();\n    }\n\n    /**\n     * Convertir une URL HTTP/HTTPS en WebSocket URL\n     */\n    buildWebSocketUrl(serverUrl) {\n        try {\n            const url = new URL(serverUrl);\n            const protocol = url.protocol === 'https:' ? 'wss:' : 'ws:';\n            return `${protocol}//${url.host}`;\n        } catch (err) {\n            console.error('‚ùå Erreur parsing serverUrl:', err);\n            // Fallback\n            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n            return `${protocol}//localhost:8060`;\n        }\n    }\n\n    /**\n     * Connecter au serveur WebSocket\n     */\n    connect() {\n        try {\n            this.ws = new WebSocket(this.wsUrl);\n            \n            this.ws.addEventListener('open', () => {\n                console.log('‚úÖ WebSocket connect√©');\n                this.reconnectAttempts = 0;\n            });\n            \n            this.ws.addEventListener('message', (event) => {\n                try {\n                    const data = JSON.parse(event.data);\n                    this.handleMessage(data);\n                } catch (err) {\n                    console.error('‚ùå Erreur parsing WebSocket:', err);\n                }\n            });\n            \n            this.ws.addEventListener('close', () => {\n                console.warn('‚ö†Ô∏è WebSocket ferm√©, reconnexion...');\n                this.reconnect();\n            });\n            \n            this.ws.addEventListener('error', (err) => {\n                console.error('‚ùå Erreur WebSocket:', err);\n                this.errorHandlers.forEach(handler => handler(err));\n            });\n        } catch (err) {\n            console.error('‚ùå Erreur connexion WebSocket:', err);\n            this.reconnect();\n        }\n    }\n\n    /**\n     * Reconnecter apr√®s d√©connexion\n     */\n    reconnect() {\n        if (this.reconnectAttempts >= this.maxReconnectAttempts) {\n            console.error('‚ùå Impossible de se reconnecter');\n            return;\n        }\n        \n        this.reconnectAttempts++;\n        console.log(`üîÑ Tentative de reconnexion ${this.reconnectAttempts}/${this.maxReconnectAttempts}`);\n        \n        setTimeout(() => {\n            this.connect();\n        }, this.reconnectDelay);\n    }\n\n    /**\n     * G√©rer les messages re√ßus\n     */\n    handleMessage(data) {\n        if (data.type === 'message') {\n            // Message de chat\n            this.messageHandlers.forEach(handler => handler({\n                type: 'newMessage',\n                message: data\n            }));\n        } else if (data.type === 'history') {\n            // Historique au d√©marrage\n            this.messageHandlers.forEach(handler => handler({\n                type: 'history',\n                messages: data.messages\n            }));\n        } else if (data.type === 'newMessage') {\n            // Nouveau message (depuis le serveur via broadcast)\n            this.messageHandlers.forEach(handler => handler({\n                type: 'newMessage',\n                message: data\n            }));\n        } else if (data.type === 'userCount') {\n            // Mise √† jour du nombre d'utilisateurs\n            this.messageHandlers.forEach(handler => handler({\n                type: 'userCount',\n                count: data.count,\n                users: data.users\n            }));\n        } else if (data.type === 'chatCleared') {\n            // Chat supprim√© par quelqu'un\n            this.messageHandlers.forEach(handler => handler({\n                type: 'chatCleared',\n                clearedBy: data.clearedBy,\n                timestamp: data.timestamp\n            }));\n        } else if (data.type === 'error') {\n            // Erreur du serveur\n            this.errorHandlers.forEach(handler => handler(data.text));\n        } else if (data.type === 'success') {\n            // Message de succ√®s du serveur\n            console.log('‚úÖ Succ√®s serveur:', data.text);\n        }\n    }\n\n    /**\n     * Envoyer un message\n     */\n    sendMessage(pseudo, message) {\n        if (!this.ws || this.ws.readyState !== WebSocket.OPEN) {\n            console.error('‚ùå WebSocket non connect√©');\n            return Promise.reject(new Error('WebSocket non connect√©'));\n        }\n        \n        return new Promise((resolve, reject) => {\n            try {\n                this.ws.send(JSON.stringify({\n                    type: 'chat',\n                    pseudo,\n                    message\n                }));\n                resolve();\n            } catch (err) {\n                reject(err);\n            }\n        });\n    }\n\n    /**\n     * Envoyer le pseudo (connexion utilisateur)\n     */\n    setPseudo(pseudo) {\n        if (!this.ws || this.ws.readyState !== WebSocket.OPEN) {\n            console.error('‚ùå WebSocket non connect√©, impossible d\\'envoyer le pseudo');\n            return Promise.reject(new Error('WebSocket non connect√©'));\n        }\n        \n        return new Promise((resolve, reject) => {\n            try {\n                this.ws.send(JSON.stringify({\n                    type: 'setPseudo',\n                    pseudo\n                }));\n                resolve();\n            } catch (err) {\n                reject(err);\n            }\n        });\n    }\n\n    /**\n     * Enregistrer un handler pour les messages\n     */\n    onMessage(handler) {\n        this.messageHandlers.push(handler);\n    }\n\n    /**\n     * Enregistrer un handler pour les erreurs\n     */\n    onError(handler) {\n        this.errorHandlers.push(handler);\n    }\n\n    /**\n     * V√©rifier si connect√©\n     */\n    isConnected() {\n        return this.ws && this.ws.readyState === WebSocket.OPEN;\n    }\n\n    /**\n     * Fermer la connexion\n     */\n    close() {\n        if (this.ws) {\n            this.ws.close();\n            this.ws = null;\n        }\n    }\n\n    /**\n     * Alias pour close()\n     */\n    disconnect() {\n        this.close();\n    }\n}\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ChatWebSocket);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wdWJsaWMvYXNzZXRzL2pzL21vZHVsZXMvY2hhdC9DaGF0V2ViU29ja2V0LmpzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDRCQUE0QjtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLFNBQVMsSUFBSSxTQUFTO0FBQzVDLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQSxzQkFBc0IsU0FBUztBQUMvQjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtREFBbUQsdUJBQXVCLEdBQUcsMEJBQTBCO0FBQ3ZHO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixVQUFVO0FBQ1Y7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLGlFQUFlLGFBQWEsRUFBQyIsInNvdXJjZXMiOlsid2VicGFjazovL3dvcmtzcGFjZS1jbGllbnQvLi9wdWJsaWMvYXNzZXRzL2pzL21vZHVsZXMvY2hhdC9DaGF0V2ViU29ja2V0LmpzPzUxODAiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDaGF0V2ViU29ja2V0IC0gQ29tbXVuaWNhdGlvbiBlbiB0ZW1wcyByw6llbCB2aWEgV2ViU29ja2V0XG4gKiBSZW1wbGFjZSBsZSBwb2xsaW5nIEhUVFAgcGFyIFdlYlNvY2tldCBwb3VyIHBsdXMgZGUgcsOpYWN0aXZpdMOpXG4gKi9cblxuY2xhc3MgQ2hhdFdlYlNvY2tldCB7XG4gICAgY29uc3RydWN0b3Iob3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIHRoaXMuc2VydmVyVXJsID0gb3B0aW9ucy5zZXJ2ZXJVcmwgfHwgJ2h0dHA6Ly9sb2NhbGhvc3Q6ODA2MCc7XG4gICAgICAgIHRoaXMud3NVcmwgPSB0aGlzLmJ1aWxkV2ViU29ja2V0VXJsKHRoaXMuc2VydmVyVXJsKTtcbiAgICAgICAgdGhpcy53cyA9IG51bGw7XG4gICAgICAgIHRoaXMubWVzc2FnZUhhbmRsZXJzID0gW107XG4gICAgICAgIHRoaXMuZXJyb3JIYW5kbGVycyA9IFtdO1xuICAgICAgICB0aGlzLnJlY29ubmVjdEF0dGVtcHRzID0gMDtcbiAgICAgICAgdGhpcy5tYXhSZWNvbm5lY3RBdHRlbXB0cyA9IDU7XG4gICAgICAgIHRoaXMucmVjb25uZWN0RGVsYXkgPSAzMDAwO1xuICAgICAgICBcbiAgICAgICAgdGhpcy5jb25uZWN0KCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ29udmVydGlyIHVuZSBVUkwgSFRUUC9IVFRQUyBlbiBXZWJTb2NrZXQgVVJMXG4gICAgICovXG4gICAgYnVpbGRXZWJTb2NrZXRVcmwoc2VydmVyVXJsKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHNlcnZlclVybCk7XG4gICAgICAgICAgICBjb25zdCBwcm90b2NvbCA9IHVybC5wcm90b2NvbCA9PT0gJ2h0dHBzOicgPyAnd3NzOicgOiAnd3M6JztcbiAgICAgICAgICAgIHJldHVybiBgJHtwcm90b2NvbH0vLyR7dXJsLmhvc3R9YDtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyZXVyIHBhcnNpbmcgc2VydmVyVXJsOicsIGVycik7XG4gICAgICAgICAgICAvLyBGYWxsYmFja1xuICAgICAgICAgICAgY29uc3QgcHJvdG9jb2wgPSB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgPT09ICdodHRwczonID8gJ3dzczonIDogJ3dzOic7XG4gICAgICAgICAgICByZXR1cm4gYCR7cHJvdG9jb2x9Ly9sb2NhbGhvc3Q6ODA2MGA7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb25uZWN0ZXIgYXUgc2VydmV1ciBXZWJTb2NrZXRcbiAgICAgKi9cbiAgICBjb25uZWN0KCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgdGhpcy53cyA9IG5ldyBXZWJTb2NrZXQodGhpcy53c1VybCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHRoaXMud3MuYWRkRXZlbnRMaXN0ZW5lcignb3BlbicsICgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn4pyFIFdlYlNvY2tldCBjb25uZWN0w6knKTtcbiAgICAgICAgICAgICAgICB0aGlzLnJlY29ubmVjdEF0dGVtcHRzID0gMDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB0aGlzLndzLmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gSlNPTi5wYXJzZShldmVudC5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVNZXNzYWdlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyZXVyIHBhcnNpbmcgV2ViU29ja2V0OicsIGVycik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHRoaXMud3MuYWRkRXZlbnRMaXN0ZW5lcignY2xvc2UnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCfimqDvuI8gV2ViU29ja2V0IGZlcm3DqSwgcmVjb25uZXhpb24uLi4nKTtcbiAgICAgICAgICAgICAgICB0aGlzLnJlY29ubmVjdCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHRoaXMud3MuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCAoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycmV1ciBXZWJTb2NrZXQ6JywgZXJyKTtcbiAgICAgICAgICAgICAgICB0aGlzLmVycm9ySGFuZGxlcnMuZm9yRWFjaChoYW5kbGVyID0+IGhhbmRsZXIoZXJyKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyZXVyIGNvbm5leGlvbiBXZWJTb2NrZXQ6JywgZXJyKTtcbiAgICAgICAgICAgIHRoaXMucmVjb25uZWN0KCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZWNvbm5lY3RlciBhcHLDqHMgZMOpY29ubmV4aW9uXG4gICAgICovXG4gICAgcmVjb25uZWN0KCkge1xuICAgICAgICBpZiAodGhpcy5yZWNvbm5lY3RBdHRlbXB0cyA+PSB0aGlzLm1heFJlY29ubmVjdEF0dGVtcHRzKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgSW1wb3NzaWJsZSBkZSBzZSByZWNvbm5lY3RlcicpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICB0aGlzLnJlY29ubmVjdEF0dGVtcHRzKys7XG4gICAgICAgIGNvbnNvbGUubG9nKGDwn5SEIFRlbnRhdGl2ZSBkZSByZWNvbm5leGlvbiAke3RoaXMucmVjb25uZWN0QXR0ZW1wdHN9LyR7dGhpcy5tYXhSZWNvbm5lY3RBdHRlbXB0c31gKTtcbiAgICAgICAgXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jb25uZWN0KCk7XG4gICAgICAgIH0sIHRoaXMucmVjb25uZWN0RGVsYXkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEfDqXJlciBsZXMgbWVzc2FnZXMgcmXDp3VzXG4gICAgICovXG4gICAgaGFuZGxlTWVzc2FnZShkYXRhKSB7XG4gICAgICAgIGlmIChkYXRhLnR5cGUgPT09ICdtZXNzYWdlJykge1xuICAgICAgICAgICAgLy8gTWVzc2FnZSBkZSBjaGF0XG4gICAgICAgICAgICB0aGlzLm1lc3NhZ2VIYW5kbGVycy5mb3JFYWNoKGhhbmRsZXIgPT4gaGFuZGxlcih7XG4gICAgICAgICAgICAgICAgdHlwZTogJ25ld01lc3NhZ2UnLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGRhdGFcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSBlbHNlIGlmIChkYXRhLnR5cGUgPT09ICdoaXN0b3J5Jykge1xuICAgICAgICAgICAgLy8gSGlzdG9yaXF1ZSBhdSBkw6ltYXJyYWdlXG4gICAgICAgICAgICB0aGlzLm1lc3NhZ2VIYW5kbGVycy5mb3JFYWNoKGhhbmRsZXIgPT4gaGFuZGxlcih7XG4gICAgICAgICAgICAgICAgdHlwZTogJ2hpc3RvcnknLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBkYXRhLm1lc3NhZ2VzXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0gZWxzZSBpZiAoZGF0YS50eXBlID09PSAnbmV3TWVzc2FnZScpIHtcbiAgICAgICAgICAgIC8vIE5vdXZlYXUgbWVzc2FnZSAoZGVwdWlzIGxlIHNlcnZldXIgdmlhIGJyb2FkY2FzdClcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZUhhbmRsZXJzLmZvckVhY2goaGFuZGxlciA9PiBoYW5kbGVyKHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnbmV3TWVzc2FnZScsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogZGF0YVxuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9IGVsc2UgaWYgKGRhdGEudHlwZSA9PT0gJ3VzZXJDb3VudCcpIHtcbiAgICAgICAgICAgIC8vIE1pc2Ugw6Agam91ciBkdSBub21icmUgZCd1dGlsaXNhdGV1cnNcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZUhhbmRsZXJzLmZvckVhY2goaGFuZGxlciA9PiBoYW5kbGVyKHtcbiAgICAgICAgICAgICAgICB0eXBlOiAndXNlckNvdW50JyxcbiAgICAgICAgICAgICAgICBjb3VudDogZGF0YS5jb3VudCxcbiAgICAgICAgICAgICAgICB1c2VyczogZGF0YS51c2Vyc1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9IGVsc2UgaWYgKGRhdGEudHlwZSA9PT0gJ2NoYXRDbGVhcmVkJykge1xuICAgICAgICAgICAgLy8gQ2hhdCBzdXBwcmltw6kgcGFyIHF1ZWxxdSd1blxuICAgICAgICAgICAgdGhpcy5tZXNzYWdlSGFuZGxlcnMuZm9yRWFjaChoYW5kbGVyID0+IGhhbmRsZXIoe1xuICAgICAgICAgICAgICAgIHR5cGU6ICdjaGF0Q2xlYXJlZCcsXG4gICAgICAgICAgICAgICAgY2xlYXJlZEJ5OiBkYXRhLmNsZWFyZWRCeSxcbiAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IGRhdGEudGltZXN0YW1wXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0gZWxzZSBpZiAoZGF0YS50eXBlID09PSAnZXJyb3InKSB7XG4gICAgICAgICAgICAvLyBFcnJldXIgZHUgc2VydmV1clxuICAgICAgICAgICAgdGhpcy5lcnJvckhhbmRsZXJzLmZvckVhY2goaGFuZGxlciA9PiBoYW5kbGVyKGRhdGEudGV4dCkpO1xuICAgICAgICB9IGVsc2UgaWYgKGRhdGEudHlwZSA9PT0gJ3N1Y2Nlc3MnKSB7XG4gICAgICAgICAgICAvLyBNZXNzYWdlIGRlIHN1Y2PDqHMgZHUgc2VydmV1clxuICAgICAgICAgICAgY29uc29sZS5sb2coJ+KchSBTdWNjw6hzIHNlcnZldXI6JywgZGF0YS50ZXh0KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEVudm95ZXIgdW4gbWVzc2FnZVxuICAgICAqL1xuICAgIHNlbmRNZXNzYWdlKHBzZXVkbywgbWVzc2FnZSkge1xuICAgICAgICBpZiAoIXRoaXMud3MgfHwgdGhpcy53cy5yZWFkeVN0YXRlICE9PSBXZWJTb2NrZXQuT1BFTikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcign4p2MIFdlYlNvY2tldCBub24gY29ubmVjdMOpJyk7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKCdXZWJTb2NrZXQgbm9uIGNvbm5lY3TDqScpKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgdGhpcy53cy5zZW5kKEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2NoYXQnLFxuICAgICAgICAgICAgICAgICAgICBwc2V1ZG8sXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEVudm95ZXIgbGUgcHNldWRvIChjb25uZXhpb24gdXRpbGlzYXRldXIpXG4gICAgICovXG4gICAgc2V0UHNldWRvKHBzZXVkbykge1xuICAgICAgICBpZiAoIXRoaXMud3MgfHwgdGhpcy53cy5yZWFkeVN0YXRlICE9PSBXZWJTb2NrZXQuT1BFTikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcign4p2MIFdlYlNvY2tldCBub24gY29ubmVjdMOpLCBpbXBvc3NpYmxlIGRcXCdlbnZveWVyIGxlIHBzZXVkbycpO1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcignV2ViU29ja2V0IG5vbiBjb25uZWN0w6knKSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHRoaXMud3Muc2VuZChKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdzZXRQc2V1ZG8nLFxuICAgICAgICAgICAgICAgICAgICBwc2V1ZG9cbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEVucmVnaXN0cmVyIHVuIGhhbmRsZXIgcG91ciBsZXMgbWVzc2FnZXNcbiAgICAgKi9cbiAgICBvbk1lc3NhZ2UoaGFuZGxlcikge1xuICAgICAgICB0aGlzLm1lc3NhZ2VIYW5kbGVycy5wdXNoKGhhbmRsZXIpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEVucmVnaXN0cmVyIHVuIGhhbmRsZXIgcG91ciBsZXMgZXJyZXVyc1xuICAgICAqL1xuICAgIG9uRXJyb3IoaGFuZGxlcikge1xuICAgICAgICB0aGlzLmVycm9ySGFuZGxlcnMucHVzaChoYW5kbGVyKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBWw6lyaWZpZXIgc2kgY29ubmVjdMOpXG4gICAgICovXG4gICAgaXNDb25uZWN0ZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLndzICYmIHRoaXMud3MucmVhZHlTdGF0ZSA9PT0gV2ViU29ja2V0Lk9QRU47XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmVybWVyIGxhIGNvbm5leGlvblxuICAgICAqL1xuICAgIGNsb3NlKCkge1xuICAgICAgICBpZiAodGhpcy53cykge1xuICAgICAgICAgICAgdGhpcy53cy5jbG9zZSgpO1xuICAgICAgICAgICAgdGhpcy53cyA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBbGlhcyBwb3VyIGNsb3NlKClcbiAgICAgKi9cbiAgICBkaXNjb25uZWN0KCkge1xuICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBDaGF0V2ViU29ja2V0O1xuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./public/assets/js/modules/chat/ChatWebSocket.js\n\n}");

/***/ })

}]);