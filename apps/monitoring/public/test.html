<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Dashboard</title>
    <style>
        body { font-family: monospace; margin: 20px; background: #1e1e1e; color: #00ff00; }
        .log { background: #111; border-left: 3px solid #0f0; padding: 8px; margin: 5px 0; }
        .error { border-left-color: #f00; color: #ff6b6b; }
        .success { border-left-color: #0f0; color: #00ff00; }
        .info { border-left-color: #0ff; color: #00ffff; }
        button { padding: 10px 20px; margin: 5px; background: #00ff00; color: #000; border: none; cursor: pointer; }
        h1 { color: #0ff; }
    </style>
</head>
<body>
    <h1>üß™ Test Dashboard</h1>
    <div id="logs"></div>
    
    <h2>Tests</h2>
    <button onclick="testAPI()">Tester API</button>
    <button onclick="testWebSocket()">Tester WebSocket</button>
    <button onclick="testServerMonitor()">Tester ServerMonitor</button>
    <button onclick="clearLogs()">Effacer logs</button>

    <script>
        // Override console.log
        const logsEl = document.getElementById('logs');
        const originalLog = console.log;
        const originalError = console.error;

        function addLog(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logsEl.appendChild(div);
            logsEl.scrollTop = logsEl.scrollHeight;
            originalLog(`[${type.toUpperCase()}]`, message);
        }

        console.log = (...args) => {
            addLog(args.join(' '), 'info');
        };

        console.error = (...args) => {
            addLog(args.join(' '), 'error');
        };

        addLog('üöÄ Page test charg√©e', 'success');

        async function testAPI() {
            addLog('üì° Test API /api/monitoring/internal/stats...', 'info');
            try {
                const res = await fetch('/api/monitoring/internal/stats');
                const data = await res.json();
                addLog(`‚úÖ API Response: ${JSON.stringify(data)}`, 'success');
            } catch (err) {
                addLog(`‚ùå Error: ${err.message}`, 'error');
            }
        }

        function testWebSocket() {
            addLog('üì° Test WebSocket...', 'info');
            const ws = new WebSocket('ws://localhost:8060');
            
            ws.onopen = () => {
                addLog('‚úÖ WebSocket connect√©', 'success');
                ws.send(JSON.stringify({ type: 'monitor', action: 'subscribe' }));
            };

            ws.onmessage = (e) => {
                addLog(`üì® Message re√ßu: ${e.data}`, 'info');
            };

            ws.onerror = (err) => {
                addLog(`‚ùå WebSocket Error: ${err}`, 'error');
            };

            ws.onclose = () => {
                addLog('‚ö†Ô∏è WebSocket ferm√©', 'info');
            };

            setTimeout(() => { ws.close(); }, 3000);
        }

        function testServerMonitor() {
            addLog('üß™ Test ServerMonitor instantiation...', 'info');
            
            // Check if Utils exists
            if (typeof Utils !== 'undefined') {
                addLog('‚úÖ Utils disponible', 'success');
            } else {
                addLog('‚ùå Utils non trouv√©', 'error');
            }

            // Check if ServerMonitor exists
            if (typeof ServerMonitor !== 'undefined') {
                addLog('‚úÖ ServerMonitor disponible', 'success');
                try {
                    const monitor = new ServerMonitor();
                    addLog('‚úÖ ServerMonitor instanci√©', 'success');
                } catch (err) {
                    addLog(`‚ùå Erreur cr√©ation ServerMonitor: ${err.message}`, 'error');
                }
            } else {
                addLog('‚ùå ServerMonitor non trouv√©', 'error');
            }
        }

        function clearLogs() {
            logsEl.innerHTML = '';
            addLog('üóëÔ∏è Logs effac√©s', 'success');
        }
    </script>

    <!-- Load scripts like the dashboard -->
    <script src="assets/js/global.js"></script>
    <script src="assets/js/modules/ServerMonitor.js"></script>

</body>
</html>
