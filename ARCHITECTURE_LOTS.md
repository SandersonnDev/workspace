# Architecture du Workflow - Vue graphique

## Flux de donnÃ©es complet

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ENTRÃ‰E - PAGE "Entrer"                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  Utilisateur ajoute des PC:                                                  â”‚
â”‚  â”œâ”€ Scan code-barres                                                         â”‚
â”‚  â”œâ”€ EntrÃ©e manuelle                                                          â”‚
â”‚  â””â”€ Saisie des champs (Type, Marque, ModÃ¨le)                               â”‚
â”‚                                                                               â”‚
â”‚  Clic â†’ "Enregistrer"                                                        â”‚
â”‚     â†“                                                                         â”‚
â”‚  POST /api/lots  [{ serial, type, marque, modele, ... }, ...]             â”‚
â”‚     â†“                                                                         â”‚
â”‚  ğŸ’¾ Base de donnÃ©es:                                                         â”‚
â”‚  â”œâ”€ INSERT INTO lots (created_at, finished_at=NULL, pdf_path=NULL)        â”‚
â”‚  â””â”€ INSERT INTO lot_items (lot_id, serial_number, ..., state='Ã€ faire')   â”‚
â”‚     â†“                                                                         â”‚
â”‚  ğŸ“„ POST /api/lots/{id}/pdf â†’ GÃ©nÃ¨re HTML template                        â”‚
â”‚     â†“                                                                         â”‚
â”‚  âœ… Redirection â†’ /pages/reception.html?section=inventaire                â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     INVENTAIRE - PAGE "Inventaire"                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  GET /api/lots?status=active                                                â”‚
â”‚     â†“                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚ Lot #123 [Created: 2026-01-09]  â”‚                                        â”‚
â”‚  â”‚ â”œâ”€ Ã€ faire: 3                   â”‚                                        â”‚
â”‚  â”‚ â”œâ”€ ReconditionnÃ©s: 1            â”‚                                        â”‚
â”‚  â”‚ â”œâ”€ HS: 1                        â”‚                                        â”‚
â”‚  â”‚ â””â”€ [Barre de progression 40%]   â”‚                                        â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                        â”‚
â”‚  â”‚ PC #1: S/N=ABC123, Type=Portableâ”‚ [Edit]                               â”‚
â”‚  â”‚        Ã‰tat: Ã€ faire                                                     â”‚
â”‚  â”‚        Technicien: -                                                     â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â”‚ PC #2: S/N=DEF456, Type=Fixe    â”‚ [Edit]                               â”‚
â”‚  â”‚        Ã‰tat: ReconditionnÃ©                                              â”‚
â”‚  â”‚        Technicien: Jean                                                 â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â”‚ ... (autres PC) ...                                                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚                                                                               â”‚
â”‚  Utilisateur clique [Edit] â†’ Ouvre modale                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚ Ã‰diter PC                       â”‚                                        â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                        â”‚
â”‚  â”‚ S/N: ABC123 (lecture seule)     â”‚                                        â”‚
â”‚  â”‚ Ã‰tat: [Ã€ faire â–¼]               â”‚ â† SÃ©lectionner                        â”‚
â”‚  â”‚ Technicien: [________]          â”‚ â† Saisie libre                       â”‚
â”‚  â”‚                                 â”‚                                        â”‚
â”‚  â”‚ [Annuler] [Enregistrer]         â”‚                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚                                                                               â”‚
â”‚  Clic â†’ "Enregistrer"                                                        â”‚
â”‚     â†“                                                                         â”‚
â”‚  PATCH /api/lots/items/{id}  { state: "ReconditionnÃ©", technician: "Jean" } â”‚
â”‚     â†“                                                                         â”‚
â”‚  ğŸ’¾ UPDATE lot_items SET state=?, technician=?                            â”‚
â”‚     â†“                                                                         â”‚
â”‚  âš™ï¸ VÃ©rifier si lot est terminÃ©:                                            â”‚
â”‚  â”œâ”€ SELECT COUNT(*) FROM lot_items WHERE lot_id=? AND state='Ã€ faire'    â”‚
â”‚  â”œâ”€ Si COUNT > 0 â†’ Lot reste en cours âœ“                                   â”‚
â”‚  â””â”€ Si COUNT = 0 â†’ UPDATE lots SET finished_at=CURRENT_TIMESTAMP        â”‚
â”‚                     â†’ Lot terminÃ©! ğŸ‰                                       â”‚
â”‚                                                                               â”‚
â”‚  [RÃ©sultat]                                                                  â”‚
â”‚  â”œâ”€ Si lot encore en cours â†’ Reste en Inventaire                           â”‚
â”‚  â””â”€ Si lot terminÃ© â†’ DisparaÃ®t d'Inventaire                               â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     HISTORIQUE - PAGE "Historique"                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  GET /api/lots?status=finished                                              â”‚
â”‚     â†“                                                                         â”‚
â”‚  Affiche uniquement les lots avec finished_at â‰  NULL                       â”‚
â”‚     â†“                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  â”‚ Lot #123 [TerminÃ© le 2026-01-09]       â”‚                               â”‚
â”‚  â”‚ â”œâ”€ ReconditionnÃ©s: 4                    â”‚                               â”‚
â”‚  â”‚ â”œâ”€ HS: 1                                â”‚                               â”‚
â”‚  â”‚ â””â”€ Total: 5                             â”‚                               â”‚
â”‚  â”‚ [Voir dÃ©tails] [PDF]                    â”‚                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                                               â”‚
â”‚  Clic â†’ "Voir dÃ©tails"                                                      â”‚
â”‚     â†“                                                                         â”‚
â”‚  Affiche modale avec tableau complet des PC:                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  â”‚ Lot #123 - DÃ©tails                      â”‚                               â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                               â”‚
â”‚  â”‚ CrÃ©Ã© le: 2026-01-09 10:30               â”‚                               â”‚
â”‚  â”‚ TerminÃ© le: 2026-01-09 14:50            â”‚                               â”‚
â”‚  â”‚ Total: 5 | ReconditionnÃ©s: 4 | HS: 1   â”‚                               â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                               â”‚
â”‚  â”‚ # â”‚ S/N    â”‚ ModÃ¨le      â”‚ Ã‰tat â”‚ Tech â”‚                               â”‚
â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                               â”‚
â”‚  â”‚ 1 â”‚ ABC123 â”‚ Dell L5410  â”‚ âœ“RC  â”‚ Jean â”‚                               â”‚
â”‚  â”‚ 2 â”‚ DEF456 â”‚ HP PB450    â”‚ âœ“RC  â”‚ Jean â”‚                               â”‚
â”‚  â”‚ 3 â”‚ GHI789 â”‚ Lenovo T14  â”‚ âœ“RC  â”‚ Marieâ”‚                               â”‚
â”‚  â”‚ 4 â”‚ JKL012 â”‚ Dell XPS13  â”‚ âœ“RC  â”‚ Jean â”‚                               â”‚
â”‚  â”‚ 5 â”‚ MNO345 â”‚ Apple MB    â”‚ âœ—HS  â”‚ Marc â”‚                               â”‚
â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                               â”‚
â”‚  â”‚ [Fermer]                                â”‚                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                                               â”‚
â”‚  Clic â†’ "PDF"                                                               â”‚
â”‚     â†“                                                                         â”‚
â”‚  Ouvre /pdfs/lot-123.html â†’ TÃ©lÃ©chargeable/Imprimable                      â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   TRAÃ‡ABILITÃ‰ - PAGE "TraÃ§abilitÃ©"                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  GET /api/lots?status=all (sorted by created_at DESC)                      â”‚
â”‚     â†“                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ # â”‚ CrÃ©Ã©   â”‚ TerminÃ© â”‚ Total â”‚ RC â”‚ HS â”‚ Statut    â”‚ Actions           â”‚ â”‚
â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚
â”‚  â”‚123â”‚ 09/01 â”‚ 09/01   â”‚ 5     â”‚ 4  â”‚ 1  â”‚ TerminÃ©   â”‚ [PDF] [Email]    â”‚ â”‚
â”‚  â”‚122â”‚ 08/01 â”‚ -       â”‚ 3     â”‚ 1  â”‚ 0  â”‚ En cours  â”‚ [GÃ©nÃ©rer] [Email]â”‚ â”‚
â”‚  â”‚121â”‚ 07/01 â”‚ 07/01   â”‚ 7     â”‚ 6  â”‚ 1  â”‚ TerminÃ©   â”‚ [PDF] [Email]    â”‚ â”‚
â”‚  â”‚...â”‚  ...  â”‚ ...     â”‚ ...   â”‚... â”‚... â”‚ ...       â”‚ ...              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                               â”‚
â”‚  Clic â†’ "GÃ©nÃ©rer"                                                           â”‚
â”‚     â†“                                                                         â”‚
â”‚  POST /api/lots/{id}/pdf                                                    â”‚
â”‚  â†’ CrÃ©e /public/pdfs/lot-{id}.html                                         â”‚
â”‚  â†’ UPDATE lots SET pdf_path=?                                               â”‚
â”‚  â†’ Notification âœ…                                                           â”‚
â”‚  â†’ Bouton change en [PDF]                                                   â”‚
â”‚                                                                               â”‚
â”‚  Clic â†’ "PDF"                                                               â”‚
â”‚     â†“                                                                         â”‚
â”‚  GET /pdfs/lot-{id}.html                                                    â”‚
â”‚  â†’ TÃ©lÃ©chargement ou affichage dans le navigateur                          â”‚
â”‚                                                                               â”‚
â”‚  Clic â†’ "Email"                                                             â”‚
â”‚     â†“                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚ Envoyer le PDF par email        â”‚                                        â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                        â”‚
â”‚  â”‚ Adresse: [_________@example.com]â”‚                                        â”‚
â”‚  â”‚ Message: [_________________]    â”‚                                        â”‚
â”‚  â”‚                                 â”‚                                        â”‚
â”‚  â”‚ [Annuler] [Envoyer]             â”‚                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚                                                                               â”‚
â”‚  Clic â†’ "Envoyer"                                                           â”‚
â”‚     â†“                                                                         â”‚
â”‚  POST /api/lots/{id}/email  { recipient, message }                        â”‚
â”‚     â†“                                                                         â”‚
â”‚  âš™ï¸ Backend:                                                                 â”‚
â”‚  â”œâ”€ Valide l'adresse email                                                 â”‚
â”‚  â”œâ”€ PrÃ©paration du PDF                                                     â”‚
â”‚  â”œâ”€ [Mode dÃ©mo]: Retourne succÃ¨s                                           â”‚
â”‚  â””â”€ [IntÃ©gration rÃ©elle]: Envoie via SMTP (nodemailer)                    â”‚
â”‚     â†“                                                                         â”‚
â”‚  Notification âœ… "Email envoyÃ© avec succÃ¨s"                               â”‚
â”‚  Modale se ferme                                                            â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Diagramme d'Ã©tat du PC

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Ã€ faire    â”‚
                    â”‚  (par dÃ©faut)â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                 [Ã‰dition du PC]
                           â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                   â”‚
    [ReconditionnÃ©]                      [HS]
         â”‚                                   â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”
    â”‚RÃ©parÃ©, OK  â”‚                    â”‚Hors     â”‚
    â”‚PrÃªt Ã  venteâ”‚                    â”‚Service  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Note: Un lot ne peut Ãªtre "terminÃ©" que lorsque 
      TOUS ses PC ne sont plus en "Ã€ faire"
```

---

## Diagramme d'Ã©tat du Lot

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ CrÃ©Ã©         â”‚
                    â”‚ created_at !=â”‚
                    â”‚ finished_at =â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
              [Ajouts de PC dans Inventaire]
                           â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                   â”‚
    [Au moins 1 PC            [Tous les PC
     est "Ã€ faire"]            != "Ã€ faire"]
         â”‚                                   â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ EN COURS      â”‚              â”‚ TERMINÃ‰        â”‚
    â”‚ Visible en    â”‚              â”‚ finished_at setâ”‚
    â”‚ Inventaire    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ Visible en     â”‚
    â”‚              â”‚   (tous PC OK) â”‚ Historique     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–²                                â”‚
         â”‚                                â”‚
    [Rajouter des                     [Archive]
     PC en "Ã€ faire"]
```

---

## Structure des tables

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          LOTS                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PRIMARY KEY)                                                â”‚
â”‚ created_at (DATETIME)    - Date crÃ©ation du lot                â”‚
â”‚ finished_at (DATETIME)   - Date marquage comme terminÃ© (NULL) â”‚
â”‚ pdf_path (TEXT)          - Chemin du PDF gÃ©nÃ©rÃ© (NULL)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–²
                            â”‚ 1:N
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      LOT_ITEMS (PC)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PRIMARY KEY)                                                â”‚
â”‚ lot_id (FOREIGN KEY â†’ lots.id)                                 â”‚
â”‚ serial_number (TEXT)     - NumÃ©ro de sÃ©rie                      â”‚
â”‚ type (TEXT)              - Type (Portable/Fixe/Ã‰cran)         â”‚
â”‚ marque_id (INT)          - ID marque                           â”‚
â”‚ modele_id (INT)          - ID modÃ¨le                           â”‚
â”‚ entry_type (TEXT)        - scan/manual                          â”‚
â”‚ date (TEXT)              - Date d'entrÃ©e                        â”‚
â”‚ time (TEXT)              - Heure d'entrÃ©e                       â”‚
â”‚ state (TEXT)             - Ã‰tat (Ã€ faire/ReconditionnÃ©/HS)   â”‚
â”‚ technician (TEXT)        - PrÃ©nom du technicien (NULL)        â”‚
â”‚ created_at (DATETIME)                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Flux d'appels API

```
FRONTEND                                BACKEND
  â”‚                                       â”‚
  â”œâ”€â†’ POST /api/lots                  â†’â”€â”€â”¤
  â”‚   { items: [...] }                   â”‚
  â”‚   â””â”€â†’ CrÃ©e lot + items               â”‚
  â”‚   â†â”€â”€ { success, id }             â†â”€â”€â”¤
  â”‚                                       â”‚
  â”œâ”€â†’ POST /api/lots/{id}/pdf         â†’â”€â”€â”¤
  â”‚   {}                                  â”‚
  â”‚   â””â”€â†’ GÃ©nÃ¨re PDF HTML                â”‚
  â”‚   â†â”€â”€ { success, path }           â†â”€â”€â”¤
  â”‚                                       â”‚
  â”œâ”€â†’ GET /api/lots?status=active     â†’â”€â”€â”¤
  â”‚                                       â”‚
  â”‚   â””â”€â†’ SELECT * FROM lots WHERE    â”‚
  â”‚       finished_at IS NULL             â”‚
  â”‚   â†â”€â”€ { items: [...] }            â†â”€â”€â”¤
  â”‚                                       â”‚
  â”œâ”€â†’ PATCH /api/lots/items/{id}      â†’â”€â”€â”¤
  â”‚   { state, technician }               â”‚
  â”‚   â””â”€â†’ UPDATE + VÃ©rif lot terminÃ©     â”‚
  â”‚   â†â”€â”€ { success, lotFinished }    â†â”€â”€â”¤
  â”‚                                       â”‚
  â”œâ”€â†’ GET /api/lots?status=finished   â†’â”€â”€â”¤
  â”‚   â””â”€â†’ SELECT * FROM lots WHERE    â”‚
  â”‚       finished_at IS NOT NULL        â”‚
  â”‚   â†â”€â”€ { items: [...] }            â†â”€â”€â”¤
  â”‚                                       â”‚
  â”œâ”€â†’ POST /api/lots/{id}/email       â†’â”€â”€â”¤
  â”‚   { recipient, message }              â”‚
  â”‚   â””â”€â†’ PrÃ©pare envoi email (dÃ©mo)     â”‚
  â”‚   â†â”€â”€ { success }                 â†â”€â”€â”¤
  â”‚                                       â”‚
  â””                                       â””
```

---

## RÃ©sumÃ© des fichiers clÃ©s

```
Frontend:
â”œâ”€â”€ entrer.html                     - Formulaire entrÃ©e
â”œâ”€â”€ inventaire.html                - Liste lots en cours
â”œâ”€â”€ historique.html                - Liste lots terminÃ©s
â”œâ”€â”€ tracabiliter.html              - Tous les lots + PDF
â”œâ”€â”€ gestion-lots.js                - Gestion formulaire (module)
â”œâ”€â”€ inventaire.js                  - Gestion inventaire (module)
â”œâ”€â”€ historique.js                  - Gestion historique (module)
â”œâ”€â”€ tracabilite.js                 - Gestion traÃ§abilitÃ© (module)
â”œâ”€â”€ entrer.css                     - Styles entrÃ©e
â”œâ”€â”€ inventaire.css                 - Styles inventaire
â”œâ”€â”€ historique.css                 - Styles historique
â”œâ”€â”€ tracabilite.css                - Styles traÃ§abilitÃ©
â””â”€â”€ app.js                         - IntÃ©gration modules

Backend:
â”œâ”€â”€ routes/lots.js                 - API endpoints
â”œâ”€â”€ database.js                    - SchÃ©ma tables
â””â”€â”€ server.js                      - Configuration serveur
```

---

## Points d'implÃ©mentation clÃ©s

âœ… **Fait**:
- CrÃ©ation des lots avec items
- Stockage en base de donnÃ©es SQLite
- Pages Inventaire, Historique, TraÃ§abilitÃ©
- Ã‰dition PC avec Ã©tat et technicien
- Transition automatique lot complet â†’ Historique
- GÃ©nÃ©ration PDF en HTML
- API email (mode dÃ©mo)

ğŸ”„ **Peut Ãªtre amÃ©liorÃ©**:
- IntÃ©gration email rÃ©elle (nodemailer + SMTP)
- PDF binaire (Puppeteer / wkhtmltopdf)
- Historique d'Ã©dition (qui a modifiÃ© quoi)
- Statistiques par technicien
- Notifications en temps rÃ©el (WebSocket)
- Export CSV/Excel

